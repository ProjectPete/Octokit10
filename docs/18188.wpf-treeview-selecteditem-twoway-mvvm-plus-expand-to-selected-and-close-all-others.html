<html !DOCTYPE html>

<head>
    <script type='text/javascript' src='https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.5.2.min.js'></script>
    <link rel='stylesheet' type='text/css' href='include/LayoutMisc.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='include/ReducedStyle.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='include/ReducedStyle2.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='include/ReducedStyle3.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='include/DynamicStyle.css' xmlns='http://www.w3.org/1999/xhtml'>
</head>

<body style='margin:20px !important;'>

    <div id='theHeader'></div>

    <!-- AUTO ADDED ABOVE -->

    <div class="post-content user-defined-markup">




<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Introduction">Introduction</a></li><li class="hierarchy-item"><a href="#Building_the_Sample">Building the Sample</a></li><li class="hierarchy-item"><a href="#Description">Description</a></li></ul><div class="hierarchy-list-footer"> </div></div><br />
<br />
<h1><a name="Introduction"></a>Introduction</h1>
<p>This sample shows how to <strong>two-way-bind</strong> to the <strong>SelectedItem</strong> property of a
<strong>WPF or Silverlight TreeView</strong>.</p>
<p>It also shows how to expand nodes down to the selected item, and collapse all other nodes (to keep it tidy).</p>
<p>&nbsp;</p>
<p style="text-align:center;"><img alt=" " id="74863" src="http://i1.code.msdn.s-msft.com/treeview-selecteditem-13985bd1/image/file/74863/1/capture11.png" height="305" width="406" /></p>
<div style="text-align:left;">&nbsp;</div>
<h1><a name="Building_the_Sample"></a><span>Building the Sample</span></h1>
<p>Just download, unzip, open and run!</p>
<p><span style="color:#ff0000;"><strong>You will also need the Silverlight 4&nbsp;SDK for the TreeView</strong></span>, or the
<a href="http://silverlight.codeplex.com/releases/view/78435">Silverlight 5 SDK</a>&nbsp;if you wish to work on your own Silverlight 5 project.<br />
The TreeView is not in the standard Silverlight framework. Remember to add an xmlns reference to the SDK if you wish to use this in your own project.</p>
<p>If you use a previous version of the SDK, just change the reference in the project.</p>
<p>&nbsp;</p>
<h1><a name="Description"></a><span style="font-size:20px;font-weight:bold;">Description</span></h1>
<p>&nbsp;<br />
The problem with the TreeView is that the SelectedItem is a read-only property. <br />
<br />
In Silverlight, you don&#39;t even have OneWayToSource, so binding two way to SelectedItem (which does exist in XAML, even if IntelliSense doesn&#39;t show it) causes binding errors.</p>
<p>The solution is to add an <strong>Attached Property</strong>, which</p>
<p>1) Taps into the SelectedItemChanged event for target-&gt;source</p>
<p>2)&nbsp;Searches down the TreeViewItems for the object to select, for source-&gt;target.</p>
<p>In the process of searching down for the selected item, it has to expand the parent node to get&nbsp;its children.
<br />
<br />
If it isn&#39;t in any of the descendants for a node, then the node gets closed again.</p>
<p>Behind all this is the following class:<br />
&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder">
<pre class="hidden"><div class="reCodeBlock"><div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;">using</code> <code style="color:#000000;">System.Windows;</code></span></div><div style="background-color:#f8f8f8;"><span><code style="color:#006699;font-weight:bold;">using</code> <code style="color:#000000;">System.Windows.Controls;</code></span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code style="color:#006699;font-weight:bold;">namespace</code> <code style="color:#000000;">SilverlightTreeview</code></span></div><div style="background-color:#ffffff;"><span><code style="color:#000000;">{</code></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">public</code> <code style="color:#006699;font-weight:bold;">class</code> <code style="color:#000000;">Attached</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">public</code> <code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">object</code> <code style="color:#000000;">GetTreeViewSelectedItem(DependencyObject obj)</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code> <code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">)obj.GetValue(TreeViewSelectedItemProperty);</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#f8f8f8;"><span>&nbsp;</span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">public</code> <code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">void</code> <code style="color:#000000;">SetTreeViewSelectedItem(DependencyObject obj, </code><code style="color:#006699;font-weight:bold;">object</code> <code style="color:#000000;">value)</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">obj.SetValue(TreeViewSelectedItemProperty, value);</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">public</code> <code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">readonly</code> <code style="color:#000000;">DependencyProperty TreeViewSelectedItemProperty =</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">DependencyProperty.RegisterAttached(</code><code style="color:blue;">&quot;TreeViewSelectedItem&quot;</code><code style="color:#000000;">, </code><code style="color:#006699;font-weight:bold;">typeof</code><code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">), </code><code style="color:#006699;font-weight:bold;">typeof</code><code style="color:#000000;">(Attached), </code><code style="color:#006699;font-weight:bold;">new</code> <code style="color:#000000;">PropertyMetadata(</code><code style="color:#006699;font-weight:bold;">new</code> <code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">(), TreeViewSelectedItemChanged));</code></span></span></div><div style="background-color:#f8f8f8;"><span>&nbsp;</span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">void</code> <code style="color:#000000;">TreeViewSelectedItemChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeView treeView = sender </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeView;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(treeView == </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">)</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#f8f8f8;"><span>&nbsp;</span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">treeView.SelectedItemChanged -= </code><code style="color:#006699;font-weight:bold;">new</code> <code style="color:#000000;">RoutedPropertyChangedEventHandler&lt;</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">&gt;(treeView_SelectedItemChanged);</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">treeView.SelectedItemChanged &#43;= </code><code style="color:#006699;font-weight:bold;">new</code> <code style="color:#000000;">RoutedPropertyChangedEventHandler&lt;</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">&gt;(treeView_SelectedItemChanged);</code></span></span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeViewItem thisItem = treeView.ItemContainerGenerator.ContainerFromItem(e.NewValue) </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeViewItem;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(thisItem != </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">)</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">thisItem.IsSelected = </code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#f8f8f8;"><span>&nbsp;</span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">for</code> <code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">int</code> <code style="color:#000000;">i = 0; i &lt; treeView.Items.Count; i&#43;&#43;)</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">SelectItem(e.NewValue, treeView.ItemContainerGenerator.ContainerFromIndex(i) </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeViewItem);</code></span></span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">void</code> <code style="color:#000000;">treeView_SelectedItemChanged(</code><code style="color:#006699;font-weight:bold;">object</code> <code style="color:#000000;">sender, RoutedPropertyChangedEventArgs&lt;</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">&gt; e)</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeView treeView = sender </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeView;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">SetTreeViewSelectedItem(treeView, e.NewValue);</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">private</code> <code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">bool</code> <code style="color:#000000;">SelectItem(</code><code style="color:#006699;font-weight:bold;">object</code> <code style="color:#000000;">o, TreeViewItem parentItem)</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(parentItem == </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">)</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code> <code style="color:#006699;font-weight:bold;">false</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#f8f8f8;"><span>&nbsp;</span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">bool</code> <code style="color:#000000;">isExpanded = parentItem.IsExpanded;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(!isExpanded)</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">parentItem.IsExpanded = </code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">parentItem.UpdateLayout();</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeViewItem item = parentItem.ItemContainerGenerator.ContainerFromItem(o) </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeViewItem;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(item != </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">)</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">item.IsSelected = </code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code> <code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#f8f8f8;"><span>&nbsp;</span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">bool</code> <code style="color:#000000;">wasFound = </code><code style="color:#006699;font-weight:bold;">false</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">for</code> <code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">int</code> <code style="color:#000000;">i = 0; i &lt; parentItem.Items.Count; i&#43;&#43;)</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeViewItem itm = parentItem.ItemContainerGenerator.ContainerFromIndex(i) </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeViewItem;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">var found = SelectItem(o, itm);</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(!found)</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">itm.IsExpanded = </code><code style="color:#006699;font-weight:bold;">false</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">else</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">wasFound = </code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code> <code style="color:#000000;">wasFound;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div><div style="background-color:#ffffff;"><span><code style="color:#000000;">}</code></span></div><div style="background-color:#f8f8f8;"><span>&nbsp;</span></div><div style="background-color:#ffffff;"><span>&nbsp;</span></div><div style="background-color:#f8f8f8;"><span><code style="color:#006699;font-weight:bold;">using</code> <code style="color:#000000;">System.Windows; </code></span></div><div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;">using</code> <code style="color:#000000;">System.Windows.Controls; </code></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;">namespace</code> <code style="color:#000000;">SilverlightTreeview </code></span></div><div style="background-color:#f8f8f8;"><span><code style="color:#000000;">{ </code></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">public</code> <code style="color:#006699;font-weight:bold;">class</code> <code style="color:#000000;">Attached </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">public</code> <code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">object</code> <code style="color:#000000;">GetTreeViewSelectedItem(DependencyObject obj) </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code> <code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">)obj.GetValue(TreeViewSelectedItemProperty); </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">public</code> <code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">void</code> <code style="color:#000000;">SetTreeViewSelectedItem(DependencyObject obj, </code><code style="color:#006699;font-weight:bold;">object</code> <code style="color:#000000;">value) </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">obj.SetValue(TreeViewSelectedItemProperty, value); </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">public</code> <code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">readonly</code> <code style="color:#000000;">DependencyProperty TreeViewSelectedItemProperty = </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">DependencyProperty.RegisterAttached(</code><code style="color:blue;">&quot;TreeViewSelectedItem&quot;</code><code style="color:#000000;">, </code><code style="color:#006699;font-weight:bold;">typeof</code><code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">), </code><code style="color:#006699;font-weight:bold;">typeof</code><code style="color:#000000;">(Attached), </code><code style="color:#006699;font-weight:bold;">new</code> <code style="color:#000000;">PropertyMetadata(</code><code style="color:#006699;font-weight:bold;">new</code> <code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">(), TreeViewSelectedItemChanged)); </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">void</code> <code style="color:#000000;">TreeViewSelectedItemChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e) </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeView treeView = sender </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeView; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(treeView == </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">) </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">treeView.SelectedItemChanged -= </code><code style="color:#006699;font-weight:bold;">new</code> <code style="color:#000000;">RoutedPropertyChangedEventHandler&lt;</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">&gt;(treeView_SelectedItemChanged); </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">treeView.SelectedItemChanged &#43;= </code><code style="color:#006699;font-weight:bold;">new</code> <code style="color:#000000;">RoutedPropertyChangedEventHandler&lt;</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">&gt;(treeView_SelectedItemChanged); </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeViewItem thisItem = treeView.ItemContainerGenerator.ContainerFromItem(e.NewValue) </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeViewItem; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(thisItem != </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">) </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">thisItem.IsSelected = </code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">for</code> <code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">int</code> <code style="color:#000000;">i = 0; i &lt; treeView.Items.Count; i&#43;&#43;) </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">SelectItem(e.NewValue, treeView.ItemContainerGenerator.ContainerFromIndex(i) </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeViewItem); </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">void</code> <code style="color:#000000;">treeView_SelectedItemChanged(</code><code style="color:#006699;font-weight:bold;">object</code> <code style="color:#000000;">sender, RoutedPropertyChangedEventArgs&lt;</code><code style="color:#006699;font-weight:bold;">object</code><code style="color:#000000;">&gt; e) </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeView treeView = sender </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeView; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">SetTreeViewSelectedItem(treeView, e.NewValue); </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">private</code> <code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">bool</code> <code style="color:#000000;">SelectItem(</code><code style="color:#006699;font-weight:bold;">object</code> <code style="color:#000000;">o, TreeViewItem parentItem) </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(parentItem == </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">) </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code> <code style="color:#006699;font-weight:bold;">false</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">bool</code> <code style="color:#000000;">isExpanded = parentItem.IsExpanded; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(!isExpanded) </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">parentItem.IsExpanded = </code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">parentItem.UpdateLayout(); </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeViewItem item = parentItem.ItemContainerGenerator.ContainerFromItem(o) </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeViewItem; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(item != </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">) </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">item.IsSelected = </code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code> <code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">bool</code> <code style="color:#000000;">wasFound = </code><code style="color:#006699;font-weight:bold;">false</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">for</code> <code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">int</code> <code style="color:#000000;">i = 0; i &lt; parentItem.Items.Count; i&#43;&#43;) </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{ </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">TreeViewItem itm = parentItem.ItemContainerGenerator.ContainerFromIndex(i) </code><code style="color:#006699;font-weight:bold;">as</code> <code style="color:#000000;">TreeViewItem; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">var found = SelectItem(o, itm); </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code> <code style="color:#000000;">(!found) </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">itm.IsExpanded = </code><code style="color:#006699;font-weight:bold;">false</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">else</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">wasFound = </code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">return</code> <code style="color:#000000;">wasFound; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">} </code></span></span></div><div style="background-color:#f8f8f8;"><span><code style="color:#000000;">} </code></span></div></div> <br /> <br />And below is an example of how to implement it:<br /> <br /><div class="reCodeBlock"><div style="background-color:#ffffff;"><span><code style="color:#000000;">&lt;</code><code style="color:#006699;font-weight:bold;">UserControl</code></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">xmlns</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;<a href="http://schemas.microsoft.com/winfx/2006/xaml/presentation">http://schemas.microsoft.com/winfx/2006/xaml/presentation</a>&quot;</code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">xmlns:x</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;<a href="http://schemas.microsoft.com/winfx/2006/xaml">http://schemas.microsoft.com/winfx/2006/xaml</a>&quot;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">xmlns:sdk</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;<a href="http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk">http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk</a>&quot;</code>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">x:Class</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;SilverlightApplication2.MainPage&quot;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">xmlns:local</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;clr-namespace:SilverlightApplication2.Helpers&quot;</code><code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;</code><span>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;</code><code style="color:#006699;font-weight:bold;">StackPanel</code> <code style="color:#808080;">x:Name</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;LayoutRoot&quot;</code> <code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;</code><code style="color:#006699;font-weight:bold;">StackPanel.Resources</code><code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;</code><code style="color:#006699;font-weight:bold;">sdk:HierarchicalDataTemplate</code> <code style="color:#808080;">x:Key</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;ChildTemplate&quot;</code> <code style="color:#808080;">ItemsSource</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;{Binding Path=Children}&quot;</code> <code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;</code><code style="color:#006699;font-weight:bold;">TextBlock</code> <code style="color:#808080;">Text</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;{Binding Path=Name}&quot;</code> <code style="color:#000000;">/&gt; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;/</code><code style="color:#006699;font-weight:bold;">sdk:HierarchicalDataTemplate</code><code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;</code><code style="color:#006699;font-weight:bold;">sdk:HierarchicalDataTemplate</code> <code style="color:#808080;">x:Key</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;NameTemplate&quot;</code>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">ItemsSource</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;{Binding Path=Children}&quot;</code>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">ItemTemplate</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;{StaticResource ChildTemplate}&quot;</code><code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;</code><code style="color:#006699;font-weight:bold;">TextBlock</code> <code style="color:#808080;">Text</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;{Binding Path=Name}&quot;</code> <code style="color:#808080;">FontWeight</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;Bold&quot;</code> <code style="color:#000000;">/&gt; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;/</code><code style="color:#006699;font-weight:bold;">sdk:HierarchicalDataTemplate</code><code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;/</code><code style="color:#006699;font-weight:bold;">StackPanel.Resources</code><code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;</code><code style="color:#006699;font-weight:bold;">sdk:TreeView</code> <code style="color:#808080;">Width</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;400&quot;</code>&nbsp; <code style="color:#808080;">Height</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;300&quot;</code>&nbsp;</span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">ItemsSource</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;{Binding HierarchicalAreas}&quot;</code>&nbsp;</span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">ItemTemplate</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;{StaticResource NameTemplate}&quot;</code> <code style="color:#808080;">x:Name</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;myTreeView&quot;</code></span></span></div><div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#808080;">local:Attached.TreeViewSelectedItem</code><code style="color:#000000;">=</code><code style="color:blue;">&quot;{Binding SelectedArea, Mode=TwoWay}&quot;</code> <code style="color:#000000;">/&gt; </code></span></span></div><div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">&lt;/</code><code style="color:#006699;font-weight:bold;">StackPanel</code><code style="color:#000000;">&gt; </code></span></span></div><div style="background-color:#f8f8f8;"><span><code style="color:#000000;">&lt;/</code><code style="color:#006699;font-weight:bold;">UserControl</code><code style="color:#000000;">&gt;</code></span></div></div><br /> <br /><em><span style="font-family:&#39;Segoe UI Semibold&#39;;color:#3a3e43;">This is a common request on MSDN WPF forum, so hope you find this when you need it.</span></em></pre>
</div>
</div>

</div>
    
    

    <!-- AUTO ADDED BELOW -->

    <div id='theFooter'></div>

    <script type='text/javascript'>
        var headerContainer = jQuery('#theHeader');
        jQuery.ajax({
            url: 'include/GitHubPagesWikiHeader.html',
            success: function (data) {
                headerContainer.html(data);
            }
        });

        var footerContainer = jQuery('#theFooter');
        jQuery.ajax({
            url: 'include/GitHubPagesWikiFooter.html',
            success: function (data) {
                footerContainer.html(data);
            }
        });
    </script>
</body>

</html>