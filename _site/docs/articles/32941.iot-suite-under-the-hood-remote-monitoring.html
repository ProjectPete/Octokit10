<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="/Octokit10/css/site.css">
    <link rel="stylesheet" href="/Octokit10/css/syntax.css">

    <link rel="stylesheet" href="/Octokit10/css/jquery.rateyo.css">

    <link rel='stylesheet' type='text/css' href='/Octokit10/css/LayoutMisc.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/Octokit10/css/ReducedStyle.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/Octokit10/css/ReducedStyle2.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/Octokit10/css/ReducedStyle3.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/Octokit10/css/DynamicStyle.css' xmlns='http://www.w3.org/1999/xhtml'>


    <title>TechNet Wikiii</title>

    <!-- This is _includes header -->

</head>

<body style='margin:20px !important;'>

    Hello 

    <div class="header-fragments" role="banner">

        <div class="header-fragment-outer fiji-header-fragment-outer site-banner">
            <div class="header-fragment-inner fiji-header-fragment-inner site-banner">
                <ul class="navigation" role="navigation">
                    <li class="nav-home"><a href="http://technet.microsoft.com/en-us/default.aspx">Home</a></li>
                    <li class="nav-library"><a href="http://technet.microsoft.com/library/en-us/default.aspx">Library</a></li>
                    <li class="nav-wiki"><a href="http://social.technet.microsoft.com/wiki/">Wiki</a></li>
                    <li class="nav-learn"><a href="http://technet.microsoft.com/en-us/bb291022.aspx">Learn</a></li>
                    <li class="nav-gallery"><a href="http://gallery.technet.microsoft.com/en-us/">Gallery</a></li>
                    <li class="nav-downloads"><a href="http://technet.microsoft.com/en-us/bb403698.aspx">Downloads</a></li>
                    <li class="nav-support"><a href="http://technet.microsoft.com/en-us/ms772425.aspx">Support</a></li>
                    <li class="nav-forums"><a href="http://social.technet.microsoft.com/Forums/en-us/">Forums</a></li>
                    <li class="nav-blogs"><a href="http://blogs.technet.com/">Blogs</a></li>
                </ul>
                <span class="IT_Resources">Resources For IT Professionals</span>
                <div class="header-fragment site-banner" id="header-fragment-668884186">

                    <div class="site-banner-header">
                    </div>
                    <div class="site-banner">

                        <div class="site-logo">
                            <a href="http://technet.microsoft.com/default.aspx" aria-label="Microsoft Technet">
                                <img src="https://social.technet.microsoft.com/wiki/themes/TechNetmetro/images/tn-logo-wiki.png" alt="Microsoft Technet Image" style="border-width:0px;">
                            </a>
                        </div>

                    </div>
                    <div id="LanguageAndCustomize">
                        <span class="localeFlyout">
                            <script src="https://i1.social.s-msft.com/wiki/rrcontent/b108147f1506a70eaa0a54d930eed5b2-a023bc3badb979ad686bdc2e246437a8-RequestReducedScript.js" type="text/javascript"></script>
                            <div class="LocaleFlyout" id="LocaleFlyout">
                                <div id="LocaleSelector">
                                    <div id="TargetPanel">
                                        <a tabindex="0">United Kingdom (Proper English-like)</a>
                                        <!--<img class="DropDownArrow" tabindex="0" aria-label="Drop down arrow" alt="Drop down arrow" src="https://social.technet.microsoft.com/wiki/themes/TechNetmetro/images/DropDownArrow_Gray.png">-->
                                    </div>
                                </div>
                            </div>
                        </span>

                    </div>
                    <a class="screen-reader-shortcut" href="#LanguageAndCustomize">Skip to locale bar</a>
                    <div class="site-banner-footer">
                    </div>
                </div>
            </div>
        </div>

        <div class="header-fragment-outer fiji-header-fragment-outer search">
            <div class="header-fragment-inner fiji-header-fragment-inner search">
                <div class="header-fragment search" id="header-fragment-668884187">

                    <div class="field-list-header">
                    </div>
                    <fieldset class="field-list">
                        <ul class="field-list">
                            <li class="field-item">
                                <span class="field-item-input">
                                    <p role="alert" style="height: 1px;width: 1px;overflow: hidden;position: absolute;"></p>
                                    <input id="Header_SearchTextBox" name="Header_SearchTextBox" type="text" class="search empty" autocomplete="off" data-searchtype="searchbox" role="combobox" aria-label="Search Input Box" aria-autocomplete="both" aria-owns="MSDNSearchAutoCompleteList" aria-live="polite" placeholder="Search TechNet with Bing" title="Search TechNet with Bing">
                                    <input id="Header_SearchButton" name="Header_SearchButton" type="image" class="search-button" src="https://social.technet.microsoft.com/wiki/themes/TechNetMetro/Images/bingSearch.png" data-searchtype="icon" title="Search TechNet with Bing">
                                    <div id="SearchFlyoutContainer" style="display: none; text-align: left; border: 1px solid buttonshadow; position: absolute; z-index: 1000; padding: 2px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Segoe UI&quot;, &quot;Lucida Grande&quot;, Verdana, Arial, Helvetica, sans-serif; font-size: 14px;"><div id="SuggestionContainer"><ul data-searchtype="search dropdown" id="MSDNSearchAutoCompleteList" role="listbox" aria-controls="Header_SearchTextBox" style="list-style: none; padding: 4px 2px 0px 1px; cursor: pointer; margin: 1px; white-space: nowrap;"></ul></div></div>
                                </span>
                            </li>
                            <li id="ctl00_ctl00_header_fragment_668884187__ffffffffc94374ed_ctl00_SearchOptionsButtonWrapper" class="field-item">
                                <span class="field-item-input">
                                    <a class="internal-link search-options" title="Change Search Scope">&nbsp;</a>
                                </span>
                            </li>
                        </ul>
                    </fieldset>
                    <div class="field-list-footer">

                        <script type='text/javascript' src='/js/jquery.min.js'></script>
                        <script src="/js/jquery.rateyo.js"></script>

                    </div>
                    <script src="https://i4.services.social.microsoft.com/Search/Widgets/SearchBox.jss?boxid=Header_SearchTextBox&amp;btnid=Header_SearchButton&amp;brand=Technet&amp;refinement=90&amp;resref=&amp;addEnglish=&amp;rn=&amp;rq=&amp;watermark=&amp;focusOnInit=false&amp;beta=0&amp;iroot=&amp;overrideWatermark=false&amp;loc=en-US" type="text/javascript" language="javascript"></script>
                    <script type="text/javascript">
                        // JSLL Record
                        var scriptJSLL = document.createElement("script");
                        scriptJSLL.type = "text/javascript";
                        scriptJSLL.src = "/js/jsll-4.2.1.js";
                        scriptJSLL.onload = function () {
                            var config = {
                                coreData: {
                                    appId: "socialtechnet"
                                }
                            };
                            awa.init(config);
                        };
                        if (document.getElementsByTagName("head") && document.getElementsByTagName("head").length > 0) {
                            document.getElementsByTagName("head")[0].appendChild(scriptJSLL);
                        }
                    </script>
                    <script type="text/javascript">
                        var textbox = document.getElementById("Header_SearchTextBox");
                        textbox.onkeypress = function (event) {
                            var n = window.mscc;
                            n && !n.hasConsent() && n.setConsent();
                        }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <div class='breadcrumb-list'>
        <span class='breadcrumb-item'><a class='internal-link view-home' href='https://github.com/technet2/Wiki/tree/master/docs'>Wiki</a></span>

        <span class='separator'><span style='display:none;'></span>&nbsp;&gt;&nbsp;</span>
        <span class='breadcrumb-item'>
            <a href='/Wiki/articles/PageIndex1.html'>TechNet Articles</a>
        </span>

        <span class='breadcrumb-item'>
            <span class='separator'><span style='display:none;'></span>&nbsp;&gt;&nbsp;</span>
            <span id="editMeCrumb" class='breadcrumb-item'>
                <!--<a href='https://github.com/technet2/Wiki/tree/master/docs/#file' class='last'>Edit this page here</a>-->
            </span>
        </span>
    </div>

    <div class='content-fragment page-navigation no-wrapper' id='fragment-6614'>
        <div class='content-fragment-inner fiji-content-fragment-inner'>
            <div class='content-fragment-top fiji-content-fragment-top'><div class='r1 fiji-r1'></div><div class='r2 fiji-r2'></div><div class='r3 fiji-r3'></div><div class='r4 fiji-r4'></div></div><div class='content-fragment-content'>

                <div class='navigation-list-header'></div>
                <ul class='navigation-list'>

                    <li class='navigation-item selected'>
                        <a class='internal-link view-wiki-page' href='#'>
                            <span></span>
                            Article
                        </a>
                    </li>

                    <li class='navigation-item'>
                        <a id="myHistory" class='internal-link wiki-page-history' href='#'>
                            <span></span>
                            History
                        </a>

                        <div style="margin-top:-30px; margin-left:80px"><div id="rateYo"></div></div>
                    </li>
                </ul>
                <div class='navigation-list-footer'></div>
            </div>
            <div class='content-fragment-footer'></div>
            <div class='content-fragment-bottom fiji-content-fragment-bottom'><div class='r1 fiji-r1'></div><div class='r2 fiji-r2'></div><div class='r3 fiji-r3'></div><div class='r4 fiji-r4'></div></div>
        </div>
    </div>

    <div id='theHeader'></div>

    <!-- This is _includes header -->
    <!-- AUTO ADDED ABOVE -->


<!-- default layout -->

<h1>IoT Suite - Under The Hood - Remote Monitoring - TechNet Articles - United States (English) - TechNet Wiki</h1>

<div class="post-content user-defined-markup">

<p><a name="top"></a><div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Introduction">Introduction</a></li><li class="hierarchy-item"><a href="#Overview">Overview</a></li><li class="hierarchy-item"><a href="#IoT_Suite_Components">IoT Suite Components</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Azure_IoT_Hub">Azure IoT Hub</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Settings">Settings</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Shared_Access_Policies">Shared Access Policies</a></li><li class="hierarchy-item"><a href="#Messaging">Messaging</a></li><li class="hierarchy-item"><a href="#Pricing_amp_scale">Pricing &amp; scale</a></li><li class="hierarchy-item"><a href="#Users">Users</a></li></ul><div class="hierarchy-list-footer"> </div></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#DocumentDb">DocumentDb</a></li><li class="hierarchy-item"><a href="#Azure_Event_Hubs">Azure Event Hubs</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Events_Hub">Events Hub</a></li><li class="hierarchy-item"><a href="#Rule_Alerts_Hub">Rule Alerts Hub</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Storage">Storage</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Table_Storage">Table Storage</a></li><li class="hierarchy-item"><a href="#Blobs">Blob Storage</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Container_actionmappings">Container: actionmappings</a></li><li class="hierarchy-item"><a href="#blob-devicerules">Container: devicerules</a></li><li class="hierarchy-item"><a href="#Container_devicetelemetry">Container: devicetelemetry</a></li><li class="hierarchy-item"><a href="#blob-thisisdemo-ehout">Container: thisisdemo-ehout</a></li><li class="hierarchy-item"><a href="#blob-rulesoutput">Container: rulesoutput</a></li></ul><div class="hierarchy-list-footer"> </div></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Stream_Analytics">Stream Analytics</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Name_ThisIsDemo-Telemetry">#1 Name: ThisIsDemo-Telemetry</a></li><li class="hierarchy-item"><a href="#Name_ThisIsDemo-DeviceInfo">#2 Name: ThisIsDemo-DeviceInfo</a></li><li class="hierarchy-item"><a href="#Name_ThisIsDemo-Rules">#3 Name: ThisIsDemo-Rules</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#App_Service_Plan">App Service Plan</a></li><li class="hierarchy-item"><a href="#Web_App">Web App</a></li><li class="hierarchy-item"><a href="#Bing_Maps_Service">Bing Maps Service</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Deleting_Everything_IoT_Suite_Created">Deleting Everything IoT Suite Created</a></li><li class="hierarchy-item"><a href="#See_Also">See Also</a></li></ul><div class="hierarchy-list-footer"> </div></div></p>
<p>&nbsp;</p>
<p>↑ <a href="#Top">Back to top</a></p>
<hr />
<h1><a name="Introduction"></a>Introduction </h1>
<p>When you create a &quot;Remote Monitoring&quot; IoT Suite solution, what you actually get is a whole bunch of cool technology wrapped up in one bundle. Everything you need to configure and end-to-end solution for device data ingress, monitoring and control.
</p>
<p>IoT Suite is an initial set-up wizard, to help your business take all the pain out of spinning up a proof-of-concept, or the initial architecture for your project.&nbsp;It will configure all the parts and wiring that you will need to create the whole solution.</p>
<p>This is great&nbsp;for spinning up &quot;proof of concept&quot; example, and even to lay the ground work for a final production solution&nbsp;You&nbsp;could just&nbsp;replace the dummy devices with real ones, and define your own rules. It is also great for generating dummy data, if you
 are working on just a user interface tool.</p>
<p>Because <a href="https://github.com/Azure/azure-iot-remote-monitoring"><strong>the solutions are available on GitHub</strong></a>, you can trace all the parts and wiring underlying the whole end-to-end solution and scenario.&nbsp;</p>
<p>This is just one example of how you can set up the system. Once you understand everything, you can chop and change as suits your needs with each project.</p>
<p>This article is a detailed checklist and breakdown of each component you get &quot;out of the box&quot; when you use the IoT Suite tool to create your IoT solution.&nbsp;</p>
<p>For a detailed description of adding devices to this solution, read&nbsp;<strong><a href="http://social.technet.microsoft.com/wiki/contents/articles/32975.iot-suite-remote-monitoring-adding-live-and-simulated-devices.aspx"><strong>IoT Suite - Remote Monitoring
 - Adding Live and Simulated Devices</strong></a>.</strong></p>
<p>&nbsp;</p>
<p>↑ <a href="#Top">Back to top</a></p>
<hr />
<h1><a name="Overview"></a>Overview </h1>
<p>&nbsp;</p>
<p>Below is the [to date] published diagram from Microsoft, which shows the basic configuration, as shown
<a href="https://azure.microsoft.com/en-us/documentation/articles/iot-suite-remote-monitoring-sample-walkthrough/">
here</a>:</p>
<p>&nbsp;</p>
<blockquote style="margin:0px 0px 0px 40px;padding:0px;border:medium none currentcolor;">
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5040.remote_2D00_monitoring_2D00_architecture.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5040.remote_2D00_monitoring_2D00_architecture.png" style="border-width:0px;border-style:solid;" /></a></p>
</blockquote>
<p>Below is the actual list of what you get by default...</p>
<ul>
<li>Azure IoT Hub (1 high-frequency unit) </li><li>Azure Stream Analytics (3 streaming units) </li><li>Azure DocumentDB (1 S2 instance) </li><li>Azure Storage (1 GRS standard, 1 LRS standard, 1 RA-GRS standard) </li><li>Azure App Services (2 S1 instances, 2 P1 instances) </li><li>Azure Event Hub (1 basic throughput unit) </li></ul>
<blockquote style="margin:0px 0px 0px 40px;padding:0px;border:medium none currentcolor;">
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5153.solutionDetails.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5153.solutionDetails.png" style="border-width:0px;border-style:solid;" /></a></p>
</blockquote>
<p>&nbsp;</p>
<p>Any resources created in &quot;IoT Suite&quot; will be grouped into a Resource Group named after the solution name you chose at the start of the process. All items of the group can therefore be easily found and maintained using the Azure Portal blades.
</p>
<blockquote style="margin:0px 0px 0px 40px;padding:0px;border:medium none currentcolor;">
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3750.resourceGroup.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3750.resourceGroup.png" style="border-width:0px;border-style:solid;" /></a></p>
</blockquote>
<p><strong><span style="color:red;">Note: The main list does not show everything. You have to click the box header or the &quot;...&quot; to see the full list blade.</span></strong></p>
<p>↑ <a href="#Top">Back to top</a></p>
<hr />
<h1><a name="IoT_Suite_Components"></a>IoT Suite Components　</h1>
<p>I have matched and documented all these resources in this article.</p>
<p>The name of each feature of the solution above is highlighted below in&nbsp;<strong><span style="color:red;">bold and red</span></strong>.</p>
<p>Names of the actual parts or each resource are also highlighted in bold.</p>
<h2><a name="Azure_IoT_Hub"></a>Azure IoT Hub </h2>
<p>Name: <a name="iot-hub"></a><strong><span style="color:red;">ThisIsDemo </span>
</strong></p>
<p>Hostname – ThisIsDemo.azure-devices.net</p>
<p>&lt;Image to come&gt;</p>
<p>This is the &quot;public hub&quot; (as opposed to the &quot;internal&quot; Event Hub detailed below) that devices connect to for data and return commands.</p>
<h3><a name="Settings"></a>Settings </h3>
<h4><a name="Shared_Access_Policies"></a>Shared Access Policies </h4>
<p>Five policies are created, below are the main three: </p>
<ol>
<li><strong>iothubowner</strong> – full permission </li><li><strong>service</strong> – service connect permission </li><li><strong>device</strong> – Device connect permission </li></ol>
<h4><a name="Messaging"></a>Messaging</h4>
<ul>
<li>Cloud-to-device (C2D) default TTL – 0 </li><li>Device-to-cloud (D2C) default retention – 1 day </li><li>D2C partitions – 4 </li><li>Consumer groups – none specific, just default </li></ul>
<h4><a name="Pricing_amp_scale"></a>Pricing &amp; scale </h4>
<ul>
<li>Default = S2 - standard </li><li>Hub Units = 1 </li></ul>
<h4><a name="Users"></a>Users </h4>
<ol>
<li>Subscription admins – The Azure subscription admins and co-admins </li></ol>
<h2><a name="DocumentDb"></a>DocumentDb </h2>
<p>Name: <span style="color:red;"><strong>ThisIsDemo-iotsuite </strong></span></p>
<p>This holds the master-list of registered devices and their differing properties. You can edit these directly in Azure Portal. Each device is a separate record in the database.</p>
<p>Storing &quot;device provisioning&quot; data in <a href="https://azure.microsoft.com/en-gb/documentation/services/documentdb/">
DocumentDb </a>means all devices are in one place, but can have their own &quot;schema&quot; of different fields. So each document is device type dependent.
</p>
<p>&nbsp;</p>
<p>&lt;Image to come&gt;</p>
<p>&nbsp;</p>
<p>Below is an example of a device file (document) with a few <strong>emboldened </strong>
points of interest: </p>
<code>
<table width="98%" border="1">
<tbody>
<tr>
<td>
<div class="reCodeBlock">
<div>{</div>
<div style="background-color:whitesmoke;">&quot;DeviceProperties&quot;: {</div>
<div>&quot;DeviceID&quot;: &quot;SampleDevice003_278&quot;,</div>
<div style="background-color:whitesmoke;">&quot;HubEnabledState&quot;: true,</div>
<div>&quot;CreatedTime&quot;: &quot;2015-10-03T14:01:10.0018032Z&quot;,</div>
<div style="background-color:whitesmoke;">&quot;DeviceState&quot;: &quot;normal&quot;,</div>
<div>&quot;UpdatedTime&quot;: &quot;2015-11-05T02:33:19.9573117Z&quot;,</div>
<div style="background-color:whitesmoke;">&quot;Manufacturer&quot;: &quot;Contoso Inc.&quot;,</div>
<div>&quot;ModelNumber&quot;: &quot;MD-81&quot;,</div>
<div style="background-color:whitesmoke;">&quot;SerialNumber&quot;: &quot;SER5553&quot;,</div>
<div>&quot;FirmwareVersion&quot;: &quot;1.30&quot;,</div>
<div style="background-color:whitesmoke;">&quot;Platform&quot;: &quot;Plat-81&quot;,</div>
<div>&quot;Processor&quot;: &quot;i3-4792&quot;,</div>
<div style="background-color:whitesmoke;">&quot;InstalledRAM&quot;: &quot;43 MB&quot;,</div>
<div>&quot;Latitude&quot;: 47.659159,</div>
<div style="background-color:whitesmoke;">&quot;Longitude&quot;: -122.141515</div>
<div>},</div>
<div style="background-color:whitesmoke;">&quot;Commands&quot;: [</div>
<div>{</div>
<div style="background-color:whitesmoke;">&quot;Name&quot;: &quot;PingDevice&quot;,</div>
<div>&quot;Parameters&quot;: null</div>
<div style="background-color:whitesmoke;">},</div>
<div>{</div>
<div style="background-color:whitesmoke;">&quot;Name&quot;: &quot;StartTelemetry&quot;,</div>
<div>&quot;Parameters&quot;: null</div>
<div style="background-color:whitesmoke;">},</div>
<div>{</div>
<div style="background-color:whitesmoke;">&quot;Name&quot;: &quot;StopTelemetry&quot;,</div>
<div>&quot;Parameters&quot;: null</div>
<div style="background-color:whitesmoke;">&nbsp;</div>
<div>},</div>
<div style="background-color:whitesmoke;">{</div>
<div>&quot;Name&quot;: &quot;ChangeSetPointTemp&quot;,</div>
<div style="background-color:whitesmoke;">&nbsp;</div>
<div>&quot;Parameters&quot;: [</div>
<div style="background-color:whitesmoke;">{</div>
<div>&quot;Name&quot;: &quot;SetPointTemp&quot;,</div>
<div style="background-color:whitesmoke;">&nbsp;</div>
<div>&quot;Type&quot;: &quot;double&quot;</div>
<div style="background-color:whitesmoke;">}</div>
<div>]},</div>
<div style="background-color:whitesmoke;">{</div>
<div>&quot;Name&quot;: &quot;DiagnosticTelemetry&quot;,</div>
<div style="background-color:whitesmoke;">&quot;Parameters&quot;: [</div>
<div>&nbsp;</div>
<div style="background-color:whitesmoke;">{</div>
<div>&quot;Name&quot;: &quot;Active&quot;,</div>
<div style="background-color:whitesmoke;">&quot;Type&quot;: &quot;boolean&quot;</div>
<div>&nbsp;</div>
<div style="background-color:whitesmoke;">}</div>
<div>]},</div>
<div style="background-color:whitesmoke;">{</div>
<div>&quot;Name&quot;: &quot;ChangeDeviceState&quot;,</div>
<div style="background-color:whitesmoke;">&quot;Parameters&quot;: [</div>
<div>{</div>
<div style="background-color:whitesmoke;">&nbsp;</div>
<div>&quot;Name&quot;: &quot;DeviceState&quot;,</div>
<div style="background-color:whitesmoke;">&quot;Type&quot;: &quot;string&quot;</div>
<div>}</div>
<div style="background-color:whitesmoke;">]}</div>
<div>],</div>
<div style="background-color:whitesmoke;">&quot;CommandHistory&quot;: [],</div>
<div>&quot;IsSimulatedDevice&quot;: 1,</div>
<div style="background-color:whitesmoke;">&quot;Version&quot;: &quot;1.0&quot;,</div>
<div>&quot;ObjectType&quot;: &quot;DeviceInfo&quot;,</div>
<div style="background-color:whitesmoke;">&quot;id&quot;: &quot;3ad1a488-17d7-48cf-bba1-de65dcd5dc08&quot;</div>
<div>}</div>
</div>
</td>
</tr>
</tbody>
</table>
</code>
<p>&nbsp;</p>
<p>The &quot;id&quot; on the last line is the actual document name, IoT Suite creates this as a GUID so that every file is unique, even if device names are the same.</p>
<h2><a name="Azure_Event_Hubs"></a>Azure Event Hubs </h2>
<p>&nbsp;</p>
<p>Name: <a name="hub-ThisIsDemo-servicebus"></a><strong><span style="color:red;">ThisIsDemo-servicebus
</span></strong></p>
<p>Type = Messaging </p>
<p>Two Event Hubs are created beneath the IoT Hub, for splitting the device data into separate streams for active monitoring applications and acting on events. These &quot;sub-hubs&quot; take filtered sub-sets of data, without commands or rules.
</p>
<p>This data streams are therefore cleaned up of unrelated data and the multi-traffic complexities of the two-way IoT Hub. This filted data tree structure also means IoT Hub itself is not overloaded with too many clients (listeners).
</p>
<p>This solution also means it [critically] remains fast and responsive to the deluge of data. Nothing is lost, ignored, or unresponsive. Queues don&#39;t overflow.
</p>
<p>Responsiveness is critical on the device/gateway side too, so it isn&#39;t locked up on a slow event hub call and missing a change or trigger on it&#39;s side.
</p>
<p>&nbsp;</p>
<h3><a name="Events_Hub"></a>Events Hub </h3>
<p>Name = <a name="hub-ThisIsDemo-ehout"></a><strong><span style="color:red;">ThisIsDemo-ehout
</span></strong></p>
<p>This is the hub which monitoring applications connect to, for a live data feed. It is a sub-set of the messages from IoT Hub. Only messages that relate specifically to device data. It is populated from the
<strong><span style="color:red;"><a href="#Name_ThisIsDemo-DeviceInfo"><strong>ThisIsDemo-DeviceInfo</strong></a></span></strong> Streaming Analytics job.&nbsp;
</p>
<p>&nbsp;</p>
<h3><a name="Rule_Alerts_Hub"></a>Rule Alerts Hub </h3>
<p>Name = <a name="hub-ThisIsDemo-ehruleout"></a><strong><span style="color:red;">ThisIsDemo-ehruleout
</span></strong></p>
<p>This hub is where device data is copied to, from Streaming Analytics job <strong>
<span style="color:red;"><a href="#Name_ThisIsDemo-Rules"><strong>ThisIsDemo-Rules</strong></a></span></strong> if it breaks any of the rules, which are defined in the
<strong><span style="color:red;"><a href="#blob-devicerules"><strong>devicerules</strong></a></span></strong> blob. This provides a tidied and isolated data set, for a scalable number of clients (like web users) to connect to.
</p>
<p>&nbsp;</p>
<h2><a name="Storage"></a>Storage </h2>
<p>Name: <a name="store-thisisdemo"></a><strong><span style="color:red;">thisisdemo
</span></strong></p>
<p>This is where history data and system configuration files are kept. This shows just one way you can configure your IoT solution. You could for example use SQL for provisioning, or stream your data into Table Storage, which is quick and cheap and has just
 enough indexing (Partition Key and &quot;compound&quot; RowKey) to analyze for reporting tools.
</p>
<p>In this default IoT Suite configuration, Microsoft use Blob Storage, with date-split directories and files defined in the Streaming Analytics &quot;path/pattern&quot; field.
</p>
<h3><a name="Table_Storage"></a>Table Storage </h3>
<p>&nbsp;</p>
<p>Name = <a name="table-DeviceList"></a><strong><span style="color:red;">DeviceList</span></strong></p>
<p>This table holds a list of which devices are to be <strong>simulated devices</strong>.</p>
<p>It holds the basic information the back end simulator needs to act on behalf of the device.</p>
<p>Columns: </p>
<ul>
<li>PartitionKey – Device name </li><li>RowKey - ThisIsDemo.azure-devices.net </li><li>Timestamp – When the device data was created </li><li>Properties
<ul>
<li>&quot;Key&quot; - Unique key for the device to authenticate </li></ul>
</li></ul>
<p>Name = <a name="table-DeviceRulesNormalizedTable"></a><strong><span style="color:red;">DeviceRulesNormalizedTable</span></strong></p>
<p>Columns:</p>
<ul>
<li>Partition Key – Device name </li><li>Row Key – A GUID </li><li>Properties
<ul>
<li>&quot;DataField&quot; = &quot;Temperature&quot; </li><li>&quot;Enabled&quot; = true </li><li>&quot;RuleOutput&quot; = &quot;AlarmTemp&quot; </li><li>&quot;Threshold&quot; = 38 </li></ul>
</li></ul>
<p>&nbsp;</p>
<h3><a name="Blobs"></a>Blob Storage</h3>
<p>&nbsp;</p>
<h4><a name="Container_actionmappings"></a>Container: <span style="color:red;"><strong>actionmappings
</strong></span></h4>
<ul>
<li>Defines the rule to action mappings in <strong>Mappings.json</strong> </li></ul>
<blockquote style="margin:0px 0px 0px 40px;padding:0px;border:medium none currentcolor;">
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8507.CaptureBlobActionMappings.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8507.CaptureBlobActionMappings.PNG" style="border-width:0px;border-style:solid;" /></a></p>
</blockquote>
<p>Below is the content:</p>
<code>
<table width="98%" border="1">
<tbody>
<tr>
<td>
<div style="color:blue;">[{&quot;RuleOutput&quot;:&quot;AlarmTemp&quot;,&quot;ActionId&quot;:&quot;Send Message&quot;},{&quot;RuleOutput&quot;:&quot;AlarmHumidity&quot;,&quot;ActionId&quot;:&quot;Raise Alarm&quot;}]</div>
</td>
</tr>
</tbody>
</table>
</code>
<h4>Container:&nbsp;<a name="blob-devicerules"></a><strong><span style="color:red;">devicerules
</span></strong></h4>
<ul>
<li>Directory [date] separated files </li><li>Contains json of any device data that breaks the rules </li></ul>
<blockquote style="margin:0px 0px 0px 40px;padding:0px;border:medium none currentcolor;">
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7077.CaptureBlobDeviceRules.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7077.CaptureBlobDeviceRules.PNG" style="border-width:0px;border-style:solid;" /></a></p>
</blockquote>
<p>Below is an example of the content:</p>
<p>&nbsp;</p>
<div style="width:99%;overflow:scroll;"><code>
<table width="98%" border="1">
<tbody>
<tr>
<td>[{<code style="color:blue;">&quot;DeviceId&quot;</code>:<code style="color:blue;">&quot;SampleDevice001_278&quot;</code>,<code style="color:blue;">&quot;Temperature&quot;</code>:38.0,<code style="color:blue;">&quot;Humidity&quot;</code>:48.0,<code style="color:blue;">&quot;TemperatureRuleOutput&quot;</code>:<code style="color:blue;">&quot;AlarmTemp&quot;</code>,<code style="color:blue;">&quot;HumidityRuleOutput&quot;</code>:<code style="color:blue;">&quot;AlarmHumidity&quot;</code>},{<code style="color:blue;">&quot;DeviceId&quot;</code>:<code style="color:blue;">&quot;SampleDevice001_510&quot;</code>,<code style="color:blue;">&quot;Temperature&quot;</code>:38.0,<code style="color:blue;">&quot;Humidity&quot;</code>:48.0,<code style="color:blue;">&quot;TemperatureRuleOutput&quot;</code>:<code style="color:blue;">&quot;AlarmTemp&quot;</code>,<code style="color:blue;">&quot;HumidityRuleOutput&quot;</code>:<code style="color:blue;">&quot;AlarmHumidity&quot;</code>}]</td>
</tr>
</tbody>
</table>
</code></div>
<p>&nbsp;Note, the value shown above is the limit that breaks the rule.</p>
<p>&nbsp;</p>
<h4><a name="Container_devicetelemetry"></a>Container:&nbsp;<strong><span style="color:red;">devicetelemetry&nbsp;</span></strong></h4>
<ul>
<li><strong><a name="blob-devicetelemetry-summary"></a>devicetelemetry-summary</strong>
<ul>
<li>Directory [date] separated files </li><li>Contains the avg/min/max aggregated data as csv from streaming analytics
<p>Below is an example of the first three rows</p>
</li></ul>
</li></ul>
<div style="width:99%;overflow:scroll;"><code>
<table width="98%" border="1">
<tbody>
<tr>
<td>
<div>deviceid,averagehumidity,minimumhumidity,maxhumidity,timeframeminutes</div>
<div style="background:whitesmoke none repeat scroll 0% 0%;">SampleDevice002_510,30.806544133199651,20.0014513949869,49.867387465139473,5</div>
<div>SampleDevice002_510,30.662442867577607,20.0014513949869,49.867387465139473,5</div>
</td>
</tr>
</tbody>
</table>
</code></div>
<ul>
<li><strong><a name="blob-devicetelemetry"></a>devicetelemetry</strong>
<ul>
<li>Directory [date] separated files </li><li>Contains the raw data in csv format from streaming analytics
<p>Below is an example of the first three rows</p>
</li></ul>
</li></ul>
<div style="width:99%;overflow:scroll;"><code>
<table width="98%" border="1">
<tbody>
<tr>
<td>
<div>DeviceId,Temperature,Humidity,ExternalTemperature,EventProcessedUtcTime,PartitionId,EventEnqueuedUtcTime</div>
<div style="background-color:whitesmoke;">SampleDevice002_510,33.544336569190349,25.443365691901725,,2015-10-03T18:00:15.4907064Z,3,2015-10-03T16:58:13.8540000Z</div>
<div>SampleDevice001_278,33.955065882557506,29.550658825575642,,2015-10-03T18:00:05.7871002Z,0,2015-10-03T16:58:14.4620000Z</div>
</td>
</tr>
</tbody>
</table>
</code></div>
<p>&nbsp;</p>
<h4>Container: <a name="blob-thisisdemo-ehout"></a><strong><span style="color:red;">thisisdemo-ehout
</span></strong></h4>
<ul>
<li>This container contains the config file that Event Hub thisisdemo-ehout uses to configure itself and folders for each consumer (only the default initially), containing status files for each partition (4 by default).&nbsp;
</li><li>You must not change files in this container. The content is created and changed by Event Hub as each partition is being processed.
<p>&lt;Image to come&gt;</p>
</li></ul>
<p>&nbsp;</p>
<h4>Container:&nbsp;<a name="blob-rulesoutput"></a><strong><span style="color:red;">rulesoutput
</span></strong></h4>
<ul>
<li>Directory [date] separated files </li><li>Contains the avg/min/max aggregated data as csv from streaming analytics
<p>&lt;Image to come&gt;</p>
<p>Below is an example of the first three rows: &nbsp;&nbsp;</p>
</li></ul>
<div style="width:99%;overflow:scroll;"><code>
<table width="98%" border="1">
<tbody>
<tr>
<td>
<div>deviceid,tempreading,tempthreshold,humidityreading,humiditythreshold,temperatureruleoutput,humidityruleoutput,time</div>
<div style="background-color:whitesmoke;">SampleDevice001_510,35.849473366071265,38,48.494733660712456,48,AlarmTemp,AlarmHumidity,2015-11-01T00:00:07.7290000Z</div>
<div>SampleDevice001_278,35.849473366071265,38,48.494733660712456,48,AlarmTemp,AlarmHumidity,2015-11-01T00:00:13.5030000Z</div>
</td>
</tr>
</tbody>
</table>
</code></div>
<p>&nbsp;</p>
<h2><a name="Stream_Analytics"></a>Stream Analytics</h2>
<p>IoT Suite creates three SA jobs that take the data from IoT Hub into three streams of data:
</p>
<ol>
<li><strong>Device Telemetry</strong> – Raw and normalized data stored straight into blob storage
</li><li><strong>Device Info</strong> – For monitoring clients like the Web App </li><li><strong>Device Rules</strong> – Any data that breaks the rules you define in the rules blob file
</li></ol>
<p>&nbsp;</p>
<h3><a name="Name_ThisIsDemo-Telemetry"></a>#1 Name: <strong><span style="color:red;">ThisIsDemo-Telemetry
</span></strong></h3>
<p>The input source is your IoT Hub.</p>
<p>This is a two way hub, so first only device ingress data is filtered, using a &quot;WITH&quot; statement to create a subset of traffic in a temporary table.
</p>
<p>It then does two things with the remaining data:</p>
<ol>
<li>Everything is passed straight into the history storage as raw data (output 1)
</li><li>A sliding Window is used to aggregate the average, minimum and maximum values into five minute chunks. This provides a smaller normalized set of values, pre-crunched for quicker analysis. (output 2)
</li></ol>
<p>&nbsp;</p>
<p><strong></strong><strong>Input&nbsp;= IoT Hub -&nbsp;&quot;</strong><strong>IoTHubStream&quot;</strong></p>
<p>Event hub name = <strong><span style="color:red;"><a href="#iot-hub"><strong>ThisIsDemo</strong></a>
</span></strong></p>
<p>Event hub policy name = iothubowner </p>
<p>Event hub consumer group = empty (default) </p>
<p>Event serialization format = JSON </p>
<p>Encoding = UTF-8</p>
<code>
<table width="98%" border="1">
<tbody>
<tr>
<td>
<div><code style="color:teal;font-weight:bold;">WITH</code></div>
<div style="background-color:whitesmoke;">[StreamData]</div>
<div><code style="color:teal;font-weight:bold;">AS</code> (</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">SELECT</code></div>
<div>*</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">FROM</code></div>
<div><span style="font-family:monospace;">[<strong>IoTHubStream</strong>]</span></div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">WHERE</code></div>
<div>[ObjectType] <code style="color:teal;font-weight:bold;">IS</code> <code style="color:grey;">
NULL</code> <code style="color:green;">-- Filter out device info and command responses</code></div>
<div style="background-color:whitesmoke;">)</div>
<div>&nbsp;</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">SELECT</code></div>
<div>*</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">INTO</code></div>
<div>[<strong>Telemetry</strong>]</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">FROM</code></div>
<div>[StreamData]</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">SELECT</code></div>
<div>DeviceId,</div>
<div style="background-color:whitesmoke;"><code style="color:pink;">AVG</code> (Humidity)
<code style="color:teal;font-weight:bold;">AS</code> [AverageHumidity],</div>
<div><code style="color:teal;font-weight:bold;">MIN</code>(Humidity) <code style="color:teal;font-weight:bold;">
AS</code> [MinimumHumidity],</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">MAX</code>(Humidity)
<code style="color:teal;font-weight:bold;">AS</code> [MaxHumidity],</div>
<div>5.0 <code style="color:teal;font-weight:bold;">AS</code> TimeframeMinutes</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">INTO</code></div>
<div>[<strong>TelemetrySummary</strong>]</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">FROM</code></div>
<div>[StreamData]</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">WHERE</code></div>
<div>[Humidity] <code style="color:teal;font-weight:bold;">IS</code> <code style="color:grey;">
NOT</code> <code style="color:grey;">NULL</code></div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">GROUP</code>
<code style="color:teal;font-weight:bold;">BY</code></div>
<div>DeviceId,</div>
<div style="background-color:whitesmoke;">SlidingWindow (mi, 5)</div>
</td>
</tr>
</tbody>
</table>
</code>
<p>&nbsp;</p>
<p><strong>Output 1</strong> : &quot;<strong>Telemetry</strong>&quot; : </p>
<p>Storage Account = <strong><span style="color:red;">thisisdemo </span></strong></p>
<p>Container = <strong><span style="color:red;"><a href="#blob-devicetelemetry"><strong>DeviceTelemetry</strong></a>
</span></strong></p>
<p>Path/pattern = <a href="#blob-devicetelemetry"><strong>devicetelemetry/{date}/{time}</strong></a>
</p>
<p>Date Format = YYYY/MM/DD </p>
<p>Time Format = HH </p>
<p>Serialization = CSV, Delimiter = comma, Encoding = UTF-8 </p>
<p>&nbsp;</p>
<p><strong>Output 2</strong> : &quot;<strong>TelemetrySummary</strong>&quot; </p>
<p>Storage Account = <strong><span style="color:red;">thisisdemo</span></strong></p>
<p>Container =&nbsp;<strong><span style="color:red;"><a href="#blob-devicetelemetry"><strong>DeviceTelemetry</strong></a></span></strong></p>
<div>Path/pattern = <a href="#blob-devicetelemetry-summary"><strong>devicetelemetry-summary/{date}/{time}</strong></a></div>
<p>Date Format = YYYY/MM/DD </p>
<p>Time Format = HH </p>
<p>Serialization = CSV, Delimiter = comma, Encoding = UTF-8 </p>
<p>&nbsp;</p>
<h3><a name="Name_ThisIsDemo-DeviceInfo"></a>#2 Name: <span style="color:red;">ThisIsDemo-DeviceInfo
</span></h3>
<p>The input source is your IoT Hub. </p>
<p>The query simply passes everything that is only device data into a &quot;sub-hub&quot;, for other clients like the Web App to consume and monitor.
</p>
<p>&nbsp;</p>
<p><strong>Input&nbsp;= IoT Hub - &quot;DeviceDataStream&quot;</strong></p>
<p>Event hub name = <a href="#iot-hub"><strong>ThisIsDemo</strong></a></p>
<p>Event hub policy name = iothubowner </p>
<p>Event hub consumer group = empty (default) </p>
<p>Event serialization format = JSON </p>
<p>Encoding = UTF-8 </p>
<p>&nbsp;</p>
<code>
<table width="98%" border="1">
<tbody>
<tr>
<td>
<div class="reCodeBlock">
<div><code style="color:teal;font-weight:bold;">SELECT</code> * <code style="color:teal;font-weight:bold;">
FROM</code> DeviceDataStream Partition <code style="color:teal;font-weight:bold;">
By</code> PartitionId <code style="color:teal;font-weight:bold;">WHERE</code> ObjectType =
<code style="color:blue;">&#39;DeviceInfo&#39;</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</code>
<p>&nbsp;</p>
<p><strong>Output</strong> – Event Hub : <strong>DeviceInfoEvents</strong></p>
<p>Event hub name = <strong><a href="#hub-ThisIsDemo-ehout"><strong>ThisIsDemo-ehout</strong></a>
</strong></p>
<p>Event hub policy name = RootManageSharedAccessKey </p>
<p>Partition key column = PartitionId </p>
<p>Event serialization format = JSON </p>
<p>Encoding = UTF-8 </p>
<p>Format = Array </p>
<p>&nbsp;</p>
<h3><a name="Name_ThisIsDemo-Rules"></a>#3 Name: <span style="color:red;">ThisIsDemo-Rules
</span></h3>
<p>The input source is your IoT Hub.</p>
<p>This query takes any device data that breaks any of the rules defined in the devicerules blob.</p>
<p>Two outputs save the data into blob storage for historical analysis, and the rules Event Hub ThisIsDemo-ehruleout for other clients to listen and act upon.
</p>
<p>Stream Analytics supports for refreshing reference data using date/time on the blob file name,
<a href="https://azure.microsoft.com/en-us/documentation/articles/stream-analytics-use-reference-data/">
<strong>described here</strong></a>. &nbsp;Each time the rules are changed, we save a new blob with a near-future time stamp so the stream job picks it up dynamically.&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<p><strong>Input Reference data – blob storage – &quot;DeviceRulesBlob&quot;</strong></p>
<p>Storage Account = <strong><span style="color:red;">thisisdemo </span></strong></p>
<p>Container = <strong><span style="color:red;"><a href="#blob-devicerules"><strong>devicerules</strong></a>
</span></strong></p>
<p>Path/pattern = {date}/{time}/devicerules.json </p>
<p>Date Format = YYYY/MM/DD </p>
<p>Serialization = JSON, Encodeing = UTF-8 </p>
<p>&nbsp;</p>
<p><strong></strong><strong>Input&nbsp;= IoT Hub -&nbsp;&quot;</strong><strong>IotTelemetryStream&quot;</strong></p>
<p>Event hub name = <span style="color:red;"><a href="#iot-hub"><strong>ThisIsDemo</strong></a></span></p>
<p>Event hub policy name = iothubowner </p>
<p>Event hub consumer group = empty (default) </p>
<p>Event serialization format = JSON </p>
<p>Encoding = UTF-8 </p>
<code>
<table width="98%" border="1">
<tbody>
<tr>
<td>
<div class="reCodeBlock">
<div><code style="color:teal;font-weight:bold;">WITH</code> AlarmsData <code style="color:teal;font-weight:bold;">
AS</code></div>
<div style="background-color:whitesmoke;">( </div>
<div><code style="color:teal;font-weight:bold;">SELECT</code></div>
<div style="background-color:whitesmoke;">Stream.DeviceID, Stream.Temperature <code style="color:teal;font-weight:bold;">
as</code> TempReading, </div>
<div>Ref.Temperature <code style="color:teal;font-weight:bold;">as</code> TempThreshold,
</div>
<div style="background-color:whitesmoke;">Stream.Humidity <code style="color:teal;font-weight:bold;">
as</code> HumidityReading, </div>
<div>Ref.Humidity <code style="color:teal;font-weight:bold;">as</code> HumidityThreshold,
</div>
<div style="background-color:whitesmoke;">Ref.TemperatureRuleOutput, </div>
<div>Ref.HumidityRuleOutput, </div>
<div style="background-color:whitesmoke;">Stream.EventEnqueuedUtcTime <code style="color:teal;font-weight:bold;">
AS</code>&nbsp; [<code style="color:teal;font-weight:bold;">Time</code>] </div>
<div><code style="color:teal;font-weight:bold;">FROM</code>&nbsp; IoTTelemetryStream Stream</div>
<div style="background-color:whitesmoke;"><code style="color:grey;">JOIN</code> DeviceRulesBlob Ref
</div>
<div><code style="color:teal;font-weight:bold;">ON</code> Stream.DeviceID = Ref.DeviceID
</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">WHERE</code></div>
<div>(</div>
<div style="background-color:whitesmoke;">Ref.Humidity <code style="color:teal;font-weight:bold;">
IS</code> <code style="color:grey;">NOT</code>&nbsp; <code style="color:grey;">null</code>
<code style="color:grey;">AND</code>&nbsp;</div>
<div>Stream.Humidity &gt; Ref.Humidity) <code style="color:grey;">OR</code></div>
<div style="background-color:whitesmoke;">(Ref.Temperature <code style="color:teal;font-weight:bold;">
IS</code> <code style="color:grey;">NOT</code>&nbsp; <code style="color:grey;">null</code>
<code style="color:grey;">AND</code>&nbsp; Stream.Temperature &gt; Ref.Temperature) </div>
<div>)</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">SELECT</code> *
<code style="color:teal;font-weight:bold;">INTO</code> DeviceRulesMonitoring </div>
<div><code style="color:teal;font-weight:bold;">FROM</code> AlarmsData</div>
<div style="background-color:whitesmoke;"><code style="color:teal;font-weight:bold;">SELECT</code> *
<code style="color:teal;font-weight:bold;">INTO</code> DeviceRulesHub </div>
<div><code style="color:teal;font-weight:bold;">FROM</code> AlarmsData</div>
</div>
</td>
</tr>
</tbody>
</table>
</code>
<p>&nbsp;</p>
<p><strong>Output 1 – Event Hub - &quot;DeviceRulesHub&quot;</strong></p>
<p>Event hub name = <span style="color:red;"><strong><a href="#hub-ThisIsDemo-ehruleout"><strong>ThisIsDemo-ehruleout</strong></a></strong></span></p>
<p>Event hub policy name = RootManageSharedAccessKey </p>
<p>Partition key column = PartitionId </p>
<p>Event serialization format = JSON </p>
<p>Encoding = UTF-8 </p>
<p>Format = Array </p>
<p>&nbsp;</p>
<p><strong>Output 2 – Blob Storage - DeviceRulesMonitoring</strong></p>
<p>Storage Account = <strong><span style="color:red;">thisisdemo </span></strong></p>
<p>Container = <span style="color:red;"><strong><a href="#blob-rulesoutput"><strong>rulesoutput</strong></a>
</strong></span></p>
<p>path/pattern = {date}/{time} </p>
<p>Date Format = YYYY/MM/DD </p>
<p>Time Format = HH </p>
<p>Serialization = CSV, Delimiter = comma, Encoding = UTF-8 </p>
<p>&nbsp;</p>
<h2><a name="App_Service_Plan"></a>App Service Plan </h2>
<p>Name: <a name="ThisIsDemo-plan"></a><strong><span style="color:red;">ThisIsDemo-plan
</span></strong></p>
<p>Pricing Tier : Standard - 2 small </p>
<p>Apps &amp; Slots – 1 </p>
<p>&nbsp;</p>
<p>Lots of useful stats, snapshots, overviews and usage limits </p>
<p>&nbsp;</p>
<h2><a name="Web_App"></a>Web App</h2>
<p>Name: <strong><span style="color:red;">ThisIsDemo&nbsp;</span></strong></p>
<p>This is the default web app Microsoft provide to monitor your device data. </p>
<p>App Service plan/pricing tier - <a href="#ThisIsDemo-plan"><strong>ThisIsDemo-plan</strong></a> (Standard: 2 Small)</p>
<blockquote style="margin:0px 0px 0px 40px;padding:0px;border:medium none currentcolor;">
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4578.CaptureIoTWeb.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4578.CaptureIoTWeb.PNG" style="border-width:0px;border-style:solid;" /></a></p>
</blockquote>
<p>&nbsp;</p>
<h2><a name="Bing_Maps_Service"></a>Bing Maps Service</h2>
<p>Name:&nbsp;<strong><span style="color:red;">ThisIsDemo-map</span></strong></p>
<p>Provider = Microsoft.BingMaps</p>
<p>Offer = mapAPIs</p>
<p>Plan = internal1 (FREE)</p>
<p>This service is added to your IoT Solution by IoT Suite to show how well Bing Maps works for such a scenario. You can of course cancel this and replace with whatever you need, like a building floor plan view. However, Bing Maps does provide a lot for free,
 potentially enough for an internal company system.</p>
<p>&quot;Use up to 10,000 free internal website cumulative transactions of any type, including sessions within any one month period. If you run out, you can upgrade to a paid plan with an increased quota.&quot;</p>
<p>&quot;Use up to 500,000 billable internal website cumulative transactions of any type, including sessions within any one month period. Need more than 500,000 transactions per month? Email maplic@microsoft.com for assistance in determining the Bing Maps service
 and licensing program that’s best for your business.&quot;</p>
<p>&nbsp;</p>
<p>↑ <a href="#Top">Back to top</a></p>
<hr />
<h1><a name="Deleting_Everything_IoT_Suite_Created"></a>Deleting Everything IoT Suite Created</h1>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>When you want to delete the complete solution, and everything that was created by IoT Suite initially and during the example, you simply have to click the delete solution button, as shown below.
</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3324.CaptureDeleteSolution.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3324.CaptureDeleteSolution.PNG" style="border-width:0px;border-style:solid;" /></a></p>
<p>Everything that was created for that specific solution, which is everything in the Resource Group and the AAD service that was created for it is deleted.
</p>
<p>You can also delete the Resource Group in Azure Portal, but this will not remove the AAD,&nbsp;as&nbsp;explained
<a href="https://azure.microsoft.com/en-us/documentation/articles/iot-suite-faq/">
here</a>.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p>
<p>&nbsp;</p>
<p>↑ <a href="#Top">Back to top</a></p>
<hr />
<h1><a name="See_Also"></a>See Also</h1>
<ul>
<li><a href="http://social.technet.microsoft.com/wiki/contents/articles/32975.iot-suite-remote-monitoring-adding-live-and-simulated-devices.aspx">IoT Suite - Remote Monitoring -
<strong>Adding Live and Simulated Devices</strong></a> </li><li><a href="https://azure.microsoft.com/en-gb/documentation/articles/iot-hub-what-is-iot-hub/">What is Azure IoT Hub?</a>
</li><li><a href="https://www.microsoft.com/en-gb/server-cloud/internet-of-things/azure-iot-suite.aspx">Azure IoT Suite</a>
</li><li><a href="https://azure.microsoft.com/en-us/documentation/articles/iot-suite-remote-monitoring-sample-walkthrough/">Remote monitoring preconfigured solution walkthrough</a>&nbsp;&nbsp;&nbsp;
</li></ul>
<p>Another important place to find an extensive amount of Cortana Intelligence Suite related articles is the TechNet Wiki itself. The best entry point is
<a href="https://social.technet.microsoft.com/wiki/contents/articles/36665.cortana-intelligence-suite-resources-on-the-technet-wiki.aspx">
Cortana Intelligence Suite Resources on the TechNet Wiki</a>. </p>

</div>
    
    

<!-- default layout -->

<!-- AUTO ADDED BELOW -->

<footer>
    <!-- This is _includes footer.html -->
    <script>
        var currentMousePos = { x: -1, y: -1 };

        $(document).ready(function () {
            $(document).mousemove(function (event) {
                currentMousePos.x = event.pageX;
                currentMousePos.y = event.pageY;
            });

            var args = document.location.href.match(/[^\/]+$/);
            var fileName = '';
            if (!args || args.length == 0) {
                return;
            }

            fileName = args[0];
            var infoFile = fileName.replace(".html", ".json");

            var fileInfo = "https://raw.githubusercontent.com/technet2/Wiki/master/docs/info/" + infoFile;
            var editVersion = "https://github.com/technet2/Wiki/blob/master/docs/articles/" + fileName;
            var historyVersion = "https://github.com/technet2/Wiki/commits/master/docs/articles/" + fileName;

            var $h1 = document.querySelector('h1');
            if ($h1) {
                title = $h1.innerText;
                $('#editMeCrumb').append($('<a href="' + editVersion + '">' + title + '!!!</a>'));
            }

            var url = "https://github.com/technet2/Wiki/commits/master/docs/articles/" + fileName;
            var $tab = document.querySelector('#myHistory');
            $tab.setAttribute('href', url);
            //$('#myHistory').setAttribute('href', url);

            $.getJSON(fileInfo, function (data) {
                var keyPhrases = [];
                $.each(data.KeyPhrases, function (key, val) {
                    keyPhrases.push("<span class=\"phr\" onclick=\"clickedPhrase('" + val.SafeName + "\')\">" + val.Name + "</span>&nbsp;|&nbsp;");
                });

                var netities = [];

                $.each(data.Netities, function (key, val) {
                    var name = val.Name;
                    var type = "";
                    if (val.Type) {
                        type += "" + val.Type;
                    }
                    if (val.SubType) {
                        type += ", " + val.SubType;
                    }
                    if (type != "") {
                        name += " (" + type + ")";
                    }
                    if (val.WikipediaUrl) {
                        netities.push("<a href='" + val.WikipediaUrl + "'>" + name + "</a>&nbsp;|&nbsp;");
                    }
                    else {
                        netities.push(name + "&nbsp;|&nbsp;");
                    }
                });

                if (keyPhrases.length > 0) {
                    $("<h2>Key Phrases Identified</h2>").appendTo("#tags");

                    $("<ul/>", {
                        "class": "tag-list",
                        html: keyPhrases.join("")
                    }).appendTo("#tags");
                }

                if (netities.length > 0) {
                    $("<h2>Entities on Wikipedia</h2>").appendTo("#tags");

                    $("<ul/>", {
                        "class": "tag-list",
                        html: netities.join("")
                    }).appendTo("#tags");
                }
            }).error(function () { console.log('No info file found for this page'); });

        });

        function goToIndex(file) {
            file = 'https://github.com/technet2/Wiki/blob/master/docs/index/' + file;
            console.log(file);
            window.location.href = file;
        }

        function goToSubIndex(file) {
            console.log(file);
            window.location.href = file;
        }

        function clickedPhrase(safeName) {
            //console.log(ele.innerText);
            var popup = $('#tagPopup');
            var tagList = $('#tagList');
            tagList.empty();

            var fileInfo = "https://raw.githubusercontent.com/technet2/Wiki/master/docs/index/" + safeName + ".json";

            $.getJSON(fileInfo, function (data) {
                var nextLinks = [];

                popup.css('visibility', 'visible');
                popup.css('left', currentMousePos.x);
                popup.css('top', currentMousePos.y);

                $.each(data.Refs, function (key, val) {
                    nextLinks.push("<div style='margin-bottom:8px;'><a href='/Wiki/articles/" + val.FileName + "'>" + val.Title + "</a></div>");
                });

                $("<div/>", {
                    "class": "link-list",
                    html: nextLinks.join("")
                }).appendTo("#tagList");
            });

        }

        $(function () {

            $("#rateYo").rateYo({

                onSet: function (rating, rateYoInstance) {

                    alert("Rating is set to: " + rating);
                }
            });
        });
    </script>

    <!--<script src="/js/site.js"></script>-->

    <div id="tags"></div>

    <div class="footer-fragments" role="contentinfo">
        <div class="footer-fragment copyright-info" id="footer-fragment-668884183">

            <ul class="footer-fragment-links">
                <li class="message copyright">C 2015 Microsoft Corporation. All rights reserved.</li>
                <li class="message termsOfService"><a href="http://technet.microsoft.com/cc300389">Terms of Use</a> </li>
                <li class="message trademarks"><a href="http://www.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx">Trademarks</a> </li>
                <li class="message privacy"><a href="http://go.microsoft.com/fwlink/?LinkId=248681">Privacy Statement</a> </li>
                <li class="message version">[Copied from] v5.6.915.0</li>
                <img tabindex="0" style="float: right;" aria-label="Microsoft" src="https://social.technet.microsoft.com/wiki/themes/TechNetMetro/images/technet/microsoft.gif">
            </ul>

            <ul class="footer-fragment-links" style="margin-top:5px !important;">
                <li>This page has been extacted by Pete Laker, <a href="https://mvp.microsoft.com/en-us/PublicProfile/5001916">Microsoft Azure MVP</a> &amp; <a href="https://www.microsoft.com/en-gb/atwork/it-implementer/">Microsoft IT Implementer</a></li>
            </ul>
        </div>

        <style>
            .phr {
                color: cornflowerblue;
            }

                .phr:hover {
                    font-weight: bold;
                    color: blue;
                    cursor: pointer;
                }
        </style>

        <div class="footer-fragment app-insights-footer-fragment" id="footer-fragment-668884184">

            <!--<span class='phr' onclick='clickedPhrase(this)'>API</span>&nbsp;|&nbsp;-->

        </div>

        <div id="tagPopup" style="background-color:#f5f3f3; visibility:hidden; position:absolute; margin:20px; border:1px solid #000000; display:block; padding:2px;">
            <span style="position:absolute; right:0; top:0; margin:2px; width:10px; height:10px; font-size:x-small; background-color:red; color:white; font-weight:bold; border:1px solid #808080; display:block; padding:2px; cursor:pointer" onclick="$('#tagPopup').css('visibility', 'hidden')">X</span>
            <div id="tagList" style="margin:5px; margin-right:15px; font-size:x-small"></div>
        </div>


    </div>
</footer>

<!-- This is _includes footer.html -->
</body>

</html>