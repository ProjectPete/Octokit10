<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="stylesheet" href="/css/jquery.rateyo.css">

    <link rel='stylesheet' type='text/css' href='/css/LayoutMisc.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/css/ReducedStyle.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/css/ReducedStyle2.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/css/ReducedStyle3.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/css/DynamicStyle.css' xmlns='http://www.w3.org/1999/xhtml'>


    <title>TechNet Wikiii</title>

    <!-- This header -->

</head>

<body style='margin:20px !important;'>

    Hello 

    <div class="header-fragments" role="banner">

        <div class="header-fragment-outer fiji-header-fragment-outer site-banner">
            <div class="header-fragment-inner fiji-header-fragment-inner site-banner">
                <ul class="navigation" role="navigation">
                    <li class="nav-home"><a href="http://technet.microsoft.com/en-us/default.aspx">Home</a></li>
                    <li class="nav-library"><a href="http://technet.microsoft.com/library/en-us/default.aspx">Library</a></li>
                    <li class="nav-wiki"><a href="http://social.technet.microsoft.com/wiki/">Wiki</a></li>
                    <li class="nav-learn"><a href="http://technet.microsoft.com/en-us/bb291022.aspx">Learn</a></li>
                    <li class="nav-gallery"><a href="http://gallery.technet.microsoft.com/en-us/">Gallery</a></li>
                    <li class="nav-downloads"><a href="http://technet.microsoft.com/en-us/bb403698.aspx">Downloads</a></li>
                    <li class="nav-support"><a href="http://technet.microsoft.com/en-us/ms772425.aspx">Support</a></li>
                    <li class="nav-forums"><a href="http://social.technet.microsoft.com/Forums/en-us/">Forums</a></li>
                    <li class="nav-blogs"><a href="http://blogs.technet.com/">Blogs</a></li>
                </ul>
                <span class="IT_Resources">Resources For IT Professionals</span>
                <div class="header-fragment site-banner" id="header-fragment-668884186">

                    <div class="site-banner-header">
                    </div>
                    <div class="site-banner">

                        <div class="site-logo">
                            <a href="http://technet.microsoft.com/default.aspx" aria-label="Microsoft Technet">
                                <img src="https://social.technet.microsoft.com/wiki/themes/TechNetmetro/images/tn-logo-wiki.png" alt="Microsoft Technet Image" style="border-width:0px;">
                            </a>
                        </div>

                    </div>
                    <div id="LanguageAndCustomize">
                        <span class="localeFlyout">
                            <script src="https://i1.social.s-msft.com/wiki/rrcontent/b108147f1506a70eaa0a54d930eed5b2-a023bc3badb979ad686bdc2e246437a8-RequestReducedScript.js" type="text/javascript"></script>
                            <div class="LocaleFlyout" id="LocaleFlyout">
                                <div id="LocaleSelector">
                                    <div id="TargetPanel">
                                        <a tabindex="0">United Kingdom (Proper English-like)</a>
                                        <!--<img class="DropDownArrow" tabindex="0" aria-label="Drop down arrow" alt="Drop down arrow" src="https://social.technet.microsoft.com/wiki/themes/TechNetmetro/images/DropDownArrow_Gray.png">-->
                                    </div>
                                </div>
                            </div>
                        </span>

                    </div>
                    <a class="screen-reader-shortcut" href="#LanguageAndCustomize">Skip to locale bar</a>
                    <div class="site-banner-footer">
                    </div>
                </div>
            </div>
        </div>

        <div class="header-fragment-outer fiji-header-fragment-outer search">
            <div class="header-fragment-inner fiji-header-fragment-inner search">
                <div class="header-fragment search" id="header-fragment-668884187">

                    <div class="field-list-header">
                    </div>
                    <fieldset class="field-list">
                        <ul class="field-list">
                            <li class="field-item">
                                <span class="field-item-input">
                                    <p role="alert" style="height: 1px;width: 1px;overflow: hidden;position: absolute;"></p>
                                    <input id="Header_SearchTextBox" name="Header_SearchTextBox" type="text" class="search empty" autocomplete="off" data-searchtype="searchbox" role="combobox" aria-label="Search Input Box" aria-autocomplete="both" aria-owns="MSDNSearchAutoCompleteList" aria-live="polite" placeholder="Search TechNet with Bing" title="Search TechNet with Bing">
                                    <input id="Header_SearchButton" name="Header_SearchButton" type="image" class="search-button" src="https://social.technet.microsoft.com/wiki/themes/TechNetMetro/Images/bingSearch.png" data-searchtype="icon" title="Search TechNet with Bing">
                                    <div id="SearchFlyoutContainer" style="display: none; text-align: left; border: 1px solid buttonshadow; position: absolute; z-index: 1000; padding: 2px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Segoe UI&quot;, &quot;Lucida Grande&quot;, Verdana, Arial, Helvetica, sans-serif; font-size: 14px;"><div id="SuggestionContainer"><ul data-searchtype="search dropdown" id="MSDNSearchAutoCompleteList" role="listbox" aria-controls="Header_SearchTextBox" style="list-style: none; padding: 4px 2px 0px 1px; cursor: pointer; margin: 1px; white-space: nowrap;"></ul></div></div>
                                </span>
                            </li>
                            <li id="ctl00_ctl00_header_fragment_668884187__ffffffffc94374ed_ctl00_SearchOptionsButtonWrapper" class="field-item">
                                <span class="field-item-input">
                                    <a class="internal-link search-options" title="Change Search Scope">&nbsp;</a>
                                </span>
                            </li>
                        </ul>
                    </fieldset>
                    <div class="field-list-footer">

                        <script type='text/javascript' src='/js/jquery.min.js'></script>
                        <script src="/js/jquery.rateyo.js"></script>

                    </div>
                    <script src="https://i4.services.social.microsoft.com/Search/Widgets/SearchBox.jss?boxid=Header_SearchTextBox&amp;btnid=Header_SearchButton&amp;brand=Technet&amp;refinement=90&amp;resref=&amp;addEnglish=&amp;rn=&amp;rq=&amp;watermark=&amp;focusOnInit=false&amp;beta=0&amp;iroot=&amp;overrideWatermark=false&amp;loc=en-US" type="text/javascript" language="javascript"></script>
                    <script type="text/javascript">
                        // JSLL Record
                        var scriptJSLL = document.createElement("script");
                        scriptJSLL.type = "text/javascript";
                        scriptJSLL.src = "/js/jsll-4.2.1.js";
                        scriptJSLL.onload = function () {
                            var config = {
                                coreData: {
                                    appId: "socialtechnet"
                                }
                            };
                            awa.init(config);
                        };
                        if (document.getElementsByTagName("head") && document.getElementsByTagName("head").length > 0) {
                            document.getElementsByTagName("head")[0].appendChild(scriptJSLL);
                        }
                    </script>
                    <script type="text/javascript">
                        var textbox = document.getElementById("Header_SearchTextBox");
                        textbox.onkeypress = function (event) {
                            var n = window.mscc;
                            n && !n.hasConsent() && n.setConsent();
                        }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <div class='breadcrumb-list'>
        <span class='breadcrumb-item'><a class='internal-link view-home' href='https://github.com/technet2/Wiki/tree/master/docs'>Wiki</a></span>

        <span class='separator'><span style='display:none;'></span>&nbsp;&gt;&nbsp;</span>
        <span class='breadcrumb-item'>
            <a href='/Wiki/articles/PageIndex1.html'>TechNet Articles</a>
        </span>

        <span class='breadcrumb-item'>
            <span class='separator'><span style='display:none;'></span>&nbsp;&gt;&nbsp;</span>
            <span id="editMeCrumb" class='breadcrumb-item'>
                <!--<a href='https://github.com/technet2/Wiki/tree/master/docs/#file' class='last'>Edit this page here</a>-->
            </span>
        </span>
    </div>

    <div class='content-fragment page-navigation no-wrapper' id='fragment-6614'>
        <div class='content-fragment-inner fiji-content-fragment-inner'>
            <div class='content-fragment-top fiji-content-fragment-top'><div class='r1 fiji-r1'></div><div class='r2 fiji-r2'></div><div class='r3 fiji-r3'></div><div class='r4 fiji-r4'></div></div><div class='content-fragment-content'>

                <div class='navigation-list-header'></div>
                <ul class='navigation-list'>

                    <li class='navigation-item selected'>
                        <a class='internal-link view-wiki-page' href='#'>
                            <span></span>
                            Article
                        </a>
                    </li>

                    <li class='navigation-item'>
                        <a id="myHistory" class='internal-link wiki-page-history' href='#'>
                            <span></span>
                            History
                        </a>

                        <div style="margin-top:-30px; margin-left:80px"><div id="rateYo"></div></div>
                    </li>
                </ul>
                <div class='navigation-list-footer'></div>
            </div>
            <div class='content-fragment-footer'></div>
            <div class='content-fragment-bottom fiji-content-fragment-bottom'><div class='r1 fiji-r1'></div><div class='r2 fiji-r2'></div><div class='r3 fiji-r3'></div><div class='r4 fiji-r4'></div></div>
        </div>
    </div>

    <div id='theHeader'></div>

    <!-- This header -->
    <!-- AUTO ADDED ABOVE -->


<!-- default layout -->

<h1>Table of Contents</h1>


## Table of Contents



- [Introduction](#Introduction)
- [Building the Sample](#Building_the_Sample)
- [Description](#Description)
  
  

# <a name="Introduction"></a>Introduction


This sample shows how to **two-way-bind** to the **SelectedItem** property of a<br>**WPF or Silverlight TreeView**.



It also shows how to expand nodes down to the selected item, and collapse all other nodes (to keep it tidy).







![ ](http://i1.code.msdn.s-msft.com/treeview-selecteditem-13985bd1/image/file/74863/1/capture11.png)




# <a name="Building_the_Sample"></a>Building the Sample


Just download, unzip, open and run!



**You will also need the Silverlight 4 SDK for the TreeView**, or the<br>[Silverlight 5 SDK](http://silverlight.codeplex.com/releases/view/78435) if you wish to work on your own Silverlight 5 project.  
<br>The TreeView is not in the standard Silverlight framework. Remember to add an xmlns reference to the SDK if you wish to use this in your own project.



If you use a previous version of the SDK, just change the reference in the project.






# <a name="Description"></a>Description


<br>The problem with the TreeView is that the SelectedItem is a read-only property.   
  
<br>In Silverlight, you don't even have OneWayToSource, so binding two way to SelectedItem (which does exist in XAML, even if IntelliSense doesn't show it) causes binding errors.



The solution is to add an **Attached Property**, which



1) Taps into the SelectedItemChanged event for target->source



2) Searches down the TreeViewItems for the object to select, for source->target.



In the process of searching down for the selected item, it has to expand the parent node to get its children.<br>  
  
<br>If it isn't in any of the descendants for a node, then the node gets closed again.



Behind all this is the following class:  
<br>


using System.Windows;using System.Windows.Controls; namespace SilverlightTreeview{    public class Attached    {        public static object GetTreeViewSelectedItem(DependencyObject obj)        {            return (object)obj.GetValue(TreeViewSelectedItemProperty);        }         public static void SetTreeViewSelectedItem(DependencyObject obj, object value)        {            obj.SetValue(TreeViewSelectedItemProperty, value);        }         public static readonly DependencyProperty TreeViewSelectedItemProperty =            DependencyProperty.RegisterAttached("TreeViewSelectedItem", typeof(object), typeof(Attached), new PropertyMetadata(new object(), TreeViewSelectedItemChanged));         static void TreeViewSelectedItemChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)        {            TreeView treeView = sender as TreeView;            if (treeView == null)            {                return;            }             treeView.SelectedItemChanged -= new RoutedPropertyChangedEventHandler<object>(treeView_SelectedItemChanged);            treeView.SelectedItemChanged += new RoutedPropertyChangedEventHandler<object>(treeView_SelectedItemChanged);             TreeViewItem thisItem = treeView.ItemContainerGenerator.ContainerFromItem(e.NewValue) as TreeViewItem;            if (thisItem != null)            {                thisItem.IsSelected = true;                return;            }             for (int i = 0; i < treeView.Items.Count; i++)                SelectItem(e.NewValue, treeView.ItemContainerGenerator.ContainerFromIndex(i) as TreeViewItem);         }         static void treeView_SelectedItemChanged(object sender, RoutedPropertyChangedEventArgs<object> e)        {            TreeView treeView = sender as TreeView;            SetTreeViewSelectedItem(treeView, e.NewValue);        }         private static bool SelectItem(object o, TreeViewItem parentItem)        {            if (parentItem == null)                return false;             bool isExpanded = parentItem.IsExpanded;            if (!isExpanded)            {                parentItem.IsExpanded = true;                parentItem.UpdateLayout();            }             TreeViewItem item = parentItem.ItemContainerGenerator.ContainerFromItem(o) as TreeViewItem;            if (item != null)            {                item.IsSelected = true;                return true;            }             bool wasFound = false;            for (int i = 0; i < parentItem.Items.Count; i++)            {                TreeViewItem itm = parentItem.ItemContainerGenerator.ContainerFromIndex(i) as TreeViewItem;                var found = SelectItem(o, itm);                if (!found)                    itm.IsExpanded = false;                else                    wasFound = true;            }             return wasFound;        }    }}  using System.Windows; using System.Windows.Controls;   namespace SilverlightTreeview {     public class Attached     {         public static object GetTreeViewSelectedItem(DependencyObject obj)         {             return (object)obj.GetValue(TreeViewSelectedItemProperty);         }           public static void SetTreeViewSelectedItem(DependencyObject obj, object value)         {             obj.SetValue(TreeViewSelectedItemProperty, value);         }           public static readonly DependencyProperty TreeViewSelectedItemProperty =             DependencyProperty.RegisterAttached("TreeViewSelectedItem", typeof(object), typeof(Attached), new PropertyMetadata(new object(), TreeViewSelectedItemChanged));           static void TreeViewSelectedItemChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)         {             TreeView treeView = sender as TreeView;             if (treeView == null)             {                 return;             }               treeView.SelectedItemChanged -= new RoutedPropertyChangedEventHandler<object>(treeView_SelectedItemChanged);             treeView.SelectedItemChanged += new RoutedPropertyChangedEventHandler<object>(treeView_SelectedItemChanged);               TreeViewItem thisItem = treeView.ItemContainerGenerator.ContainerFromItem(e.NewValue) as TreeViewItem;             if (thisItem != null)             {                 thisItem.IsSelected = true;                 return;             }               for (int i = 0; i < treeView.Items.Count; i++)                 SelectItem(e.NewValue, treeView.ItemContainerGenerator.ContainerFromIndex(i) as TreeViewItem);           }           static void treeView_SelectedItemChanged(object sender, RoutedPropertyChangedEventArgs<object> e)         {             TreeView treeView = sender as TreeView;             SetTreeViewSelectedItem(treeView, e.NewValue);         }           private static bool SelectItem(object o, TreeViewItem parentItem)         {             if (parentItem == null)                 return false;               bool isExpanded = parentItem.IsExpanded;             if (!isExpanded)             {                 parentItem.IsExpanded = true;                 parentItem.UpdateLayout();             }               TreeViewItem item = parentItem.ItemContainerGenerator.ContainerFromItem(o) as TreeViewItem;             if (item != null)             {                 item.IsSelected = true;                 return true;             }               bool wasFound = false;             for (int i = 0; i < parentItem.Items.Count; i++)             {                 TreeViewItem itm = parentItem.ItemContainerGenerator.ContainerFromIndex(i) as TreeViewItem;                 var found = SelectItem(o, itm);                 if (!found)                     itm.IsExpanded = false;                 else                    wasFound = true;             }               return wasFound;         }     } }   And below is an example of how to implement it: <UserControl    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"    xmlns:sdk="http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk"     x:Class="SilverlightApplication2.MainPage"    xmlns:local="clr-namespace:SilverlightApplication2.Helpers">       <StackPanel x:Name="LayoutRoot" >         <StackPanel.Resources>             <sdk:HierarchicalDataTemplate x:Key="ChildTemplate" ItemsSource="{Binding Path=Children}" >                 <TextBlock Text="{Binding Path=Name}" />             </sdk:HierarchicalDataTemplate>             <sdk:HierarchicalDataTemplate x:Key="NameTemplate"                 ItemsSource="{Binding Path=Children}"                 ItemTemplate="{StaticResource ChildTemplate}">                 <TextBlock Text="{Binding Path=Name}" FontWeight="Bold" />             </sdk:HierarchicalDataTemplate>         </StackPanel.Resources>         <sdk:TreeView Width="400"  Height="300"             ItemsSource="{Binding HierarchicalAreas}"             ItemTemplate="{StaticResource NameTemplate}" x:Name="myTreeView"            local:Attached.TreeViewSelectedItem="{Binding SelectedArea, Mode=TwoWay}" />     </StackPanel> </UserControl> This is a common request on MSDN WPF forum, so hope you find this when you need it.


<!-- default layout -->

<!-- AUTO ADDED BELOW -->

<footer>
    <!-- This footer.html -->
    <script>
        var currentMousePos = { x: -1, y: -1 };

        $(document).ready(function () {
            $(document).mousemove(function (event) {
                currentMousePos.x = event.pageX;
                currentMousePos.y = event.pageY;
            });

            var args = document.location.href.match(/[^\/]+$/);
            var fileName = '';
            if (!args || args.length == 0) {
                return;
            }

            fileName = args[0];
            var infoFile = fileName.replace(".html", ".json");

            var fileInfo = "https://raw.githubusercontent.com/technet2/Wiki/master/docs/info/" + infoFile;
            var editVersion = "https://github.com/technet2/Wiki/blob/master/docs/articles/" + fileName;
            var historyVersion = "https://github.com/technet2/Wiki/commits/master/docs/articles/" + fileName;

            var $h1 = document.querySelector('h1');
            if ($h1) {
                title = $h1.innerText;
                $('#editMeCrumb').append($('<a href="' + editVersion + '">' + title + '!!!</a>'));
            }

            var url = "https://github.com/technet2/Wiki/commits/master/docs/articles/" + fileName;
            var $tab = document.querySelector('#myHistory');
            $tab.setAttribute('href', url);
            //$('#myHistory').setAttribute('href', url);

            $.getJSON(fileInfo, function (data) {
                var keyPhrases = [];
                $.each(data.KeyPhrases, function (key, val) {
                    keyPhrases.push("<span class=\"phr\" onclick=\"clickedPhrase('" + val.SafeName + "\')\">" + val.Name + "</span>&nbsp;|&nbsp;");
                });

                var netities = [];

                $.each(data.Netities, function (key, val) {
                    var name = val.Name;
                    var type = "";
                    if (val.Type) {
                        type += "" + val.Type;
                    }
                    if (val.SubType) {
                        type += ", " + val.SubType;
                    }
                    if (type != "") {
                        name += " (" + type + ")";
                    }
                    if (val.WikipediaUrl) {
                        netities.push("<a href='" + val.WikipediaUrl + "'>" + name + "</a>&nbsp;|&nbsp;");
                    }
                    else {
                        netities.push(name + "&nbsp;|&nbsp;");
                    }
                });

                if (keyPhrases.length > 0) {
                    $("<h2>Key Phrases Identified</h2>").appendTo("#tags");

                    $("<ul/>", {
                        "class": "tag-list",
                        html: keyPhrases.join("")
                    }).appendTo("#tags");
                }

                if (netities.length > 0) {
                    $("<h2>Entities on Wikipedia</h2>").appendTo("#tags");

                    $("<ul/>", {
                        "class": "tag-list",
                        html: netities.join("")
                    }).appendTo("#tags");
                }
            }).error(function () { console.log('No info file found for this page'); });

        });

        function goToIndex(file) {
            file = 'https://github.com/technet2/Wiki/blob/master/docs/index/' + file;
            console.log(file);
            window.location.href = file;
        }

        function goToSubIndex(file) {
            console.log(file);
            window.location.href = file;
        }

        function clickedPhrase(safeName) {
            //console.log(ele.innerText);
            var popup = $('#tagPopup');
            var tagList = $('#tagList');
            tagList.empty();

            var fileInfo = "https://raw.githubusercontent.com/technet2/Wiki/master/docs/index/" + safeName + ".json";

            $.getJSON(fileInfo, function (data) {
                var nextLinks = [];

                popup.css('visibility', 'visible');
                popup.css('left', currentMousePos.x);
                popup.css('top', currentMousePos.y);

                $.each(data.Refs, function (key, val) {
                    nextLinks.push("<div style='margin-bottom:8px;'><a href='/Wiki/articles/" + val.FileName + "'>" + val.Title + "</a></div>");
                });

                $("<div/>", {
                    "class": "link-list",
                    html: nextLinks.join("")
                }).appendTo("#tagList");
            });

        }

        $(function () {

            $("#rateYo").rateYo({

                onSet: function (rating, rateYoInstance) {

                    alert("Rating is set to: " + rating);
                }
            });
        });
    </script>

    <script src="/js/site.js"></script>

    <div id="tags"></div>

    <div class="footer-fragments" role="contentinfo">
        <div class="footer-fragment copyright-info" id="footer-fragment-668884183">

            <ul class="footer-fragment-links">
                <li class="message copyright">C 2015 Microsoft Corporation. All rights reserved.</li>
                <li class="message termsOfService"><a href="http://technet.microsoft.com/cc300389">Terms of Use</a> </li>
                <li class="message trademarks"><a href="http://www.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx">Trademarks</a> </li>
                <li class="message privacy"><a href="http://go.microsoft.com/fwlink/?LinkId=248681">Privacy Statement</a> </li>
                <li class="message version">[Copied from] v5.6.915.0</li>
                <img tabindex="0" style="float: right;" aria-label="Microsoft" src="https://social.technet.microsoft.com/wiki/themes/TechNetMetro/images/technet/microsoft.gif">
            </ul>

            <ul class="footer-fragment-links" style="margin-top:5px !important;">
                <li>This page has been extacted by Pete Laker, <a href="https://mvp.microsoft.com/en-us/PublicProfile/5001916">Microsoft Azure MVP</a> &amp; <a href="https://www.microsoft.com/en-gb/atwork/it-implementer/">Microsoft IT Implementer</a></li>
            </ul>
        </div>

        <style>
            .phr {
                color: cornflowerblue;
            }

                .phr:hover {
                    font-weight: bold;
                    color: blue;
                    cursor: pointer;
                }
        </style>

        <div class="footer-fragment app-insights-footer-fragment" id="footer-fragment-668884184">

            <!--<span class='phr' onclick='clickedPhrase(this)'>API</span>&nbsp;|&nbsp;-->

        </div>

        <div id="tagPopup" style="background-color:#f5f3f3; visibility:hidden; position:absolute; margin:20px; border:1px solid #000000; display:block; padding:2px;">
            <span style="position:absolute; right:0; top:0; margin:2px; width:10px; height:10px; font-size:x-small; background-color:red; color:white; font-weight:bold; border:1px solid #808080; display:block; padding:2px; cursor:pointer" onclick="$('#tagPopup').css('visibility', 'hidden')">X</span>
            <div id="tagList" style="margin:5px; margin-right:15px; font-size:x-small"></div>
        </div>


    </div>
</footer>

<!-- This footer.html -->
</body>

</html>