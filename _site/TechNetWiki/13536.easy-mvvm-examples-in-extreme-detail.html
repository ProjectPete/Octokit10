<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="/Octokit10/css/site.css">
    <link rel="stylesheet" href="/Octokit10/css/syntax.css">

    <link rel="stylesheet" href="/Octokit10/css/jquery.rateyo.css">

    <link rel='stylesheet' type='text/css' href='/Octokit10/css/LayoutMisc.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/Octokit10/css/ReducedStyle.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/Octokit10/css/ReducedStyle2.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/Octokit10/css/ReducedStyle3.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='/Octokit10/css/DynamicStyle.css' xmlns='http://www.w3.org/1999/xhtml'>


    <title>TechNet Wikiii</title>

    <!-- This header -->

</head>

<body style='margin:20px !important;'>

    Hello 

    <div class="header-fragments" role="banner">

        <div class="header-fragment-outer fiji-header-fragment-outer site-banner">
            <div class="header-fragment-inner fiji-header-fragment-inner site-banner">
                <ul class="navigation" role="navigation">
                    <li class="nav-home"><a href="http://technet.microsoft.com/en-us/default.aspx">Home</a></li>
                    <li class="nav-library"><a href="http://technet.microsoft.com/library/en-us/default.aspx">Library</a></li>
                    <li class="nav-wiki"><a href="http://social.technet.microsoft.com/wiki/">Wiki</a></li>
                    <li class="nav-learn"><a href="http://technet.microsoft.com/en-us/bb291022.aspx">Learn</a></li>
                    <li class="nav-gallery"><a href="http://gallery.technet.microsoft.com/en-us/">Gallery</a></li>
                    <li class="nav-downloads"><a href="http://technet.microsoft.com/en-us/bb403698.aspx">Downloads</a></li>
                    <li class="nav-support"><a href="http://technet.microsoft.com/en-us/ms772425.aspx">Support</a></li>
                    <li class="nav-forums"><a href="http://social.technet.microsoft.com/Forums/en-us/">Forums</a></li>
                    <li class="nav-blogs"><a href="http://blogs.technet.com/">Blogs</a></li>
                </ul>
                <span class="IT_Resources">Resources For IT Professionals</span>
                <div class="header-fragment site-banner" id="header-fragment-668884186">

                    <div class="site-banner-header">
                    </div>
                    <div class="site-banner">

                        <div class="site-logo">
                            <a href="http://technet.microsoft.com/default.aspx" aria-label="Microsoft Technet">
                                <img src="https://social.technet.microsoft.com/wiki/themes/TechNetmetro/images/tn-logo-wiki.png" alt="Microsoft Technet Image" style="border-width:0px;">
                            </a>
                        </div>

                    </div>
                    <div id="LanguageAndCustomize">
                        <span class="localeFlyout">
                            <script src="https://i1.social.s-msft.com/wiki/rrcontent/b108147f1506a70eaa0a54d930eed5b2-a023bc3badb979ad686bdc2e246437a8-RequestReducedScript.js" type="text/javascript"></script>
                            <div class="LocaleFlyout" id="LocaleFlyout">
                                <div id="LocaleSelector">
                                    <div id="TargetPanel">
                                        <a tabindex="0">United Kingdom (Proper English-like)</a>
                                        <!--<img class="DropDownArrow" tabindex="0" aria-label="Drop down arrow" alt="Drop down arrow" src="https://social.technet.microsoft.com/wiki/themes/TechNetmetro/images/DropDownArrow_Gray.png">-->
                                    </div>
                                </div>
                            </div>
                        </span>

                    </div>
                    <a class="screen-reader-shortcut" href="#LanguageAndCustomize">Skip to locale bar</a>
                    <div class="site-banner-footer">
                    </div>
                </div>
            </div>
        </div>

        <div class="header-fragment-outer fiji-header-fragment-outer search">
            <div class="header-fragment-inner fiji-header-fragment-inner search">
                <div class="header-fragment search" id="header-fragment-668884187">

                    <div class="field-list-header">
                    </div>
                    <fieldset class="field-list">
                        <ul class="field-list">
                            <li class="field-item">
                                <span class="field-item-input">
                                    <p role="alert" style="height: 1px;width: 1px;overflow: hidden;position: absolute;"></p>
                                    <input id="Header_SearchTextBox" name="Header_SearchTextBox" type="text" class="search empty" autocomplete="off" data-searchtype="searchbox" role="combobox" aria-label="Search Input Box" aria-autocomplete="both" aria-owns="MSDNSearchAutoCompleteList" aria-live="polite" placeholder="Search TechNet with Bing" title="Search TechNet with Bing">
                                    <input id="Header_SearchButton" name="Header_SearchButton" type="image" class="search-button" src="https://social.technet.microsoft.com/wiki/themes/TechNetMetro/Images/bingSearch.png" data-searchtype="icon" title="Search TechNet with Bing">
                                    <div id="SearchFlyoutContainer" style="display: none; text-align: left; border: 1px solid buttonshadow; position: absolute; z-index: 1000; padding: 2px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Segoe UI&quot;, &quot;Lucida Grande&quot;, Verdana, Arial, Helvetica, sans-serif; font-size: 14px;"><div id="SuggestionContainer"><ul data-searchtype="search dropdown" id="MSDNSearchAutoCompleteList" role="listbox" aria-controls="Header_SearchTextBox" style="list-style: none; padding: 4px 2px 0px 1px; cursor: pointer; margin: 1px; white-space: nowrap;"></ul></div></div>
                                </span>
                            </li>
                            <li id="ctl00_ctl00_header_fragment_668884187__ffffffffc94374ed_ctl00_SearchOptionsButtonWrapper" class="field-item">
                                <span class="field-item-input">
                                    <a class="internal-link search-options" title="Change Search Scope">&nbsp;</a>
                                </span>
                            </li>
                        </ul>
                    </fieldset>
                    <div class="field-list-footer">

                        <script type='text/javascript' src='/js/jquery.min.js'></script>
                        <script src="/js/jquery.rateyo.js"></script>

                    </div>
                    <script src="https://i4.services.social.microsoft.com/Search/Widgets/SearchBox.jss?boxid=Header_SearchTextBox&amp;btnid=Header_SearchButton&amp;brand=Technet&amp;refinement=90&amp;resref=&amp;addEnglish=&amp;rn=&amp;rq=&amp;watermark=&amp;focusOnInit=false&amp;beta=0&amp;iroot=&amp;overrideWatermark=false&amp;loc=en-US" type="text/javascript" language="javascript"></script>
                    <script type="text/javascript">
                        // JSLL Record
                        var scriptJSLL = document.createElement("script");
                        scriptJSLL.type = "text/javascript";
                        scriptJSLL.src = "/js/jsll-4.2.1.js";
                        scriptJSLL.onload = function () {
                            var config = {
                                coreData: {
                                    appId: "socialtechnet"
                                }
                            };
                            awa.init(config);
                        };
                        if (document.getElementsByTagName("head") && document.getElementsByTagName("head").length > 0) {
                            document.getElementsByTagName("head")[0].appendChild(scriptJSLL);
                        }
                    </script>
                    <script type="text/javascript">
                        var textbox = document.getElementById("Header_SearchTextBox");
                        textbox.onkeypress = function (event) {
                            var n = window.mscc;
                            n && !n.hasConsent() && n.setConsent();
                        }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <div class='breadcrumb-list'>
        <span class='breadcrumb-item'><a class='internal-link view-home' href='https://github.com/technet2/Wiki/tree/master/docs'>Wiki</a></span>

        <span class='separator'><span style='display:none;'></span>&nbsp;&gt;&nbsp;</span>
        <span class='breadcrumb-item'>
            <a href='/Wiki/articles/PageIndex1.html'>TechNet Articles</a>
        </span>

        <span class='breadcrumb-item'>
            <span class='separator'><span style='display:none;'></span>&nbsp;&gt;&nbsp;</span>
            <span id="editMeCrumb" class='breadcrumb-item'>
                <!--<a href='https://github.com/technet2/Wiki/tree/master/docs/#file' class='last'>Edit this page here</a>-->
            </span>
        </span>
    </div>

    <div class='content-fragment page-navigation no-wrapper' id='fragment-6614'>
        <div class='content-fragment-inner fiji-content-fragment-inner'>
            <div class='content-fragment-top fiji-content-fragment-top'><div class='r1 fiji-r1'></div><div class='r2 fiji-r2'></div><div class='r3 fiji-r3'></div><div class='r4 fiji-r4'></div></div><div class='content-fragment-content'>

                <div class='navigation-list-header'></div>
                <ul class='navigation-list'>

                    <li class='navigation-item selected'>
                        <a class='internal-link view-wiki-page' href='#'>
                            <span></span>
                            Article
                        </a>
                    </li>

                    <li class='navigation-item'>
                        <a id="myHistory" class='internal-link wiki-page-history' href='#'>
                            <span></span>
                            History
                        </a>

                        <div style="margin-top:-30px; margin-left:80px"><div id="rateYo"></div></div>
                    </li>
                </ul>
                <div class='navigation-list-footer'></div>
            </div>
            <div class='content-fragment-footer'></div>
            <div class='content-fragment-bottom fiji-content-fragment-bottom'><div class='r1 fiji-r1'></div><div class='r2 fiji-r2'></div><div class='r3 fiji-r3'></div><div class='r4 fiji-r4'></div></div>
        </div>
    </div>

    <div id='theHeader'></div>

    <!-- This header -->
    <!-- AUTO ADDED ABOVE -->


<!-- default layout -->

<h1></h1>


**This article discusses the various methods and tricks used in MVVM, to enable a developer to completely separate the user interface from the code. It demonstrates all the basics with easy examples to follow, in a downloadable project.**  

## Table of Contents



- [Introduction](#Introduction)


  - [About the Sample Project](#About_the_Sample_Project)
- [Classic INotifyPropertyChanged](#Classic_INotifyPropertyChanged)


  - [Switching Windows from Event Handlers in Code-behind](#Switching_windows_from_traditional_event_handlers_in_code-behind)
- [DataContext Made in Code](#DataContext_Made_in_Code)


  - [Closing Windows from the ViewModel](#Closing_Windows_from_the_ViewModel)
- [Using DependencyObject instead of INPC](#Using_DependencyObject_instead_of_INPC)


  - [Controlling an Application through CanExecute](#Controlling_an_Application_through_CanExecute)
  - [Closing with Attached Property via Dependency Property](#Closing_with_a_Attached_Property_via_Dependency_Property)
- [Using POCO Objects with MVVM](#Using_POCO_objects_with_MVVM)


  - [Custom Event Self-close Hack](#Custom_Event_Self-close_Hack)
  - [Fixing One Property to Show the Difference](#Tweaking_one_property_to_show_the_difference)
  - [A Cleaner 'Interface' Way to Close the Window](#A_Cleaner_Interface_Way_to_Close_the_Window)
- [How to Consume a Closed Business Object (database layer, web service)](#How_to_consume_a_closed_Business_Object_database_layer_web_service)


  - [Wrapping POCOs](#Wrapping_POCOs)
  - [Polling POCOs](#Polling_POCOs)
  - [Virtually Codeless Master/Detail CRUD Control](#Codeless_Master_Detail_CRUD_for_databases_web_services_etc)


    - [How to Bind and When to Update](#How_to_bind_and_when_to_update)
    - [Create, Update, Delete Logic](#Add_Update_or_Delete)
  

# <a name="Introduction"></a>Introduction
  
**Model View ViewModel** is the golden child of WPF, allowing a developer to completely separate their application code from any UI dependencies.<br>  
  
<br>This means an application can be easily be re-skinned, and it also makes an application much easier to test.<br>  
  
<br>The **View** represents any front-end user interface controls (Window, Page, UserControl), the<br>**Model** represents the classes used in the application, and the **<br>ViewModel** is the middle-man that requests, molds and exposes the data, as properties and commands.  
<br>   

## **About the Sample Project**
  
<br>This is article is linked to a TechNet sample project that you can download and explore.<br>  
<br>It covers many basic concepts of MVVM, and some of the common pitfalls and solutions.  
  
**The idea is to download the sample, run it to see each example, then read through this, along side the code.**  
**By the time you have finished, you should know most of what you need to know :)**   
<br>   
**DOWNLOAD :**[**http://gallery.technet.microsoft.com/Easy-MVVM-Examples-48c94de3**](http://gallery.technet.microsoft.com/Easy-MVVM-Examples-48c94de3)  
  
  
<br>If you're looking for more good WPF examples, you will probably enjoy [<br>my other Gallery sample projects](http://code.msdn.microsoft.com/site/search?f%5B0%5D.Type=User&f%5B0%5D.Value=XAML%20guy). all I ask is that you rate (star) them, thanks.  

#  


↑ [Return to Top](http://social.technet.microsoft.com/wiki/contents/articles/13536.easy-mvvm-examples-in-extreme-detail.aspx#Top)


* * *





# <a name="Classic_INotifyPropertyChanged"></a>Classic INotifyPropertyChanged
[![ ](http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/456x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0336.mvvm1.png)](http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0336.mvvm1.png)  
  
<br>This first example is **the classic MVVM configuration**, implementing<br>**INotifyPropertyChanged** in a base class (**ViewModelBase**)  
<br>   

classViewModelBase : INotifyPropertyChanged

{

    internalvoid RaisePropertyChanged(stringprop)

    {

        if(PropertyChanged !=null) { PropertyChanged(this,new PropertyChangedEventArgs(prop)); }

    }

    publicevent PropertyChangedEventHandler PropertyChanged;
  
<br>This base class contains the common code used by all properties of all other derived ViewModels, one is shown below.  
<br>   

string_TextProperty1;

publicstring TextProperty1

{

    get

    {

        return_TextProperty1;

    }

    set

    {

        if(_TextProperty1 != value)

        {

            _TextProperty1 = value;

            RaisePropertyChanged("TextProperty1");

        }

    }

}
  
<br>As you can see, it looks like a standard CLI object, but with the extra **RaisePropertyChanged** method in the setter.  
  
<br>In example 1, the ViewModel is attached by the View itself, **in XAML**. Notice this is possible because the ViewModel does not need any parameters in it's constructor.  
<br>   

<Window. . .

        xmlns:vm="clr-namespace:MvvmExample.ViewModel"

        DataContext="{DynamicResource ViewModelMain}">



    <Window.Resources>

        <vm:ViewModelMainx:Key="ViewModelMain"/>

    </Window.Resources>
  
<br>There is a **ListBox**, **DataGrid** and **ComboBox,** ALL with<br>*ItemsSource* to the same collection, and the same *SeletedItem*.  
<br>Changes to the values of any of the properties in the DataGrid are reflected across all controls.  
<br>As you change the selected Person in any of these controls, you will see all three change together.  
<br>A TextBox and TextBlock share the same property, so changes in the TextBox reflect in the TextBlock.  
<br>Click the button to add a user, it shows in all three controls.  
  
<br>Although many would think that this is all due to our 'enriched' INPC classes, most of this is<br>**actually triggered by changing the values through the UI**, as explained later.  
<br>    
<br>Only the Add user command relies on PropertyChanged events, and they come from the changing ObservableCollection.  
<br>   

## **Switching Windows from Event Handlers in Code-behind**
  
<br>A traditional method of triggering functions and navigating from one window to another is using code-behind event handlers.  
<br>This means your code is tightly coupled with the user interface.  
<br>   

privatevoid Button_Click(object sender, RoutedEventArgs e)

{

    var win =new Window1 { DataContext =newViewModelWindow1(tb1.Text) };

    win.Show();

    this.Close();

}
  
<br>The most common first question in MVVM is**how to call methods of a control like Window.Close() from a ViewModel**.<br>  
<br>   
**This is shown in the next example.**  
  


↑ [Return to Top](http://social.technet.microsoft.com/wiki/contents/articles/13536.easy-mvvm-examples-in-extreme-detail.aspx#Top)


* * *
  

# <a name="DataContext_Made_in_Code"></a>DataContext Made in Code
[![ ](http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/345x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6710.mvvm2.png)](http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6710.mvvm2.png)  
  
<br>The second example simply shows how you can attach the ViewModel to the DataContext **from code**, done by the previous window shown above, as this window was created.  
<br>   

var win =new Window1 { DataContext =newViewModelWindow1(tb1.Text) };
  
<br>In this example, the ViewModel takes a string parameter in it's constructor. Work done in the constructor is BEFORE binding occurs, so we can populate<br>**private variables**:  
<br>   

publicViewModelWindow1(stringlastText)

{

    _TestText = lastText;
  
<br>This ViewModel is derived from ViewModelMain, with an extra public property and command to pull a value from the base class and update this new property.  
  
<br>The Button command passes in a value from the UI in the **CommandParameter**. This saves us having to reference controls directly from code.  
<br>   

<ButtonContent="Change Text"Command="{Binding ChangeTextCommand}"CommandParameter="{Binding SelectedItem, ElementName=dg1}"/>
  
<br>In this example, the selected person is used to make the value for **public property** TestText.<br>  
  
<br>This command is triggered **AFTER** the page has finished binding, so we target the<br>**public property**, so the **PropertyChanged event is triggered**.  
  
<br>This is so the bindings related to that property know that they need to update, otherwise changes will never be reflected in the UI.  
<br>   

voidChangeText(objectselectedItem)

{

    if(selectedItem ==null)

        TestText ="Please select a person";

    else

    {

        var person = selectedItemas Person;

        TestText = person.FirstName +" " + person.LastName;

    }

}

##  

## **Closing Windows from the ViewModel**
  
<br>This second example shows a nice way to **close a window** **from a ViewModel**, using an<br>**Attached Behavior**.   
<br>   
<br>The "**close window**" behavior is added from an **attached property** called<br>**DialogResult**.  
  

publicstatic class DialogCloser

{

    publicstatic readonly DependencyProperty DialogResultProperty =

    DependencyProperty.RegisterAttached(

    "DialogResult",

    typeof(bool?),

    typeof(DialogCloser),

    newPropertyMetadata(DialogResultChanged));



    privatestatic void DialogResultChanged(

    DependencyObject d,

    DependencyPropertyChangedEventArgs e)

    {

        var window = das Window;

        if(window !=null)  window.Close();

    }

    publicstatic void SetDialogResult(Window target,bool? value)

    {

        target.SetValue(DialogResultProperty, value);

    }

}
  
<br>This is then attached to the Windows that we want to control:  
  

<Windowx:Class="MvvmExample.ViewModel.Window1"WindowStartupLocation="CenterScreen"

        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"

        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"

        Title="Window1"Height="300"Width="400"

        **xmlns:helpers="clr-namespace:MvvmExample.Helpers"**

        **helpers:DialogCloser.DialogResult="{Binding
 CloseWindowFlag}"**>
  
<br>As all our Windows use ViewModels, which all inherit from **ViewModelBase**, we can put this generic window closer property and Close method**in the base class**:  
  

bool? _CloseWindowFlag;

publicbool? CloseWindowFlag

{

    get{return_CloseWindowFlag; }

    set

    {

        _CloseWindowFlag = value;

        RaisePropertyChanged("CloseWindowFlag");

    }

}



publicvirtual void CloseWindow(bool? result =true)

{

    Application.Current.Dispatcher.BeginInvoke(DispatcherPriority.Background,new Action(() =>

    {

        CloseWindowFlag = CloseWindowFlag ==null

            ?true

            : !CloseWindowFlag;

    }));

}
  
<br>Our actual **ViewModel can now handle navigation and closing windows** as shown:  
  

voidNextExample(objectparameter)

{

    var win =new Window2();

    win.Show();

    CloseWindow();

}
  
  


↑ [Return to Top](http://social.technet.microsoft.com/wiki/contents/articles/13536.easy-mvvm-examples-in-extreme-detail.aspx#Top)


* * *
  

# <a name="Using_DependencyObject_instead_of_INPC"></a>Using DependencyObject instead of INPC
[![ ](http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/316x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0272.mvvm3.png)](http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0272.mvvm3.png)  
  
<br>This example shows the alternative to INotifyPropertyChanged - **DependencyObject** and<br>**Dependency Properties**.  
  

classViewModelWindow2 : DependencyObject

{

    publicPerson SelectedPerson

    {

        get{return(Person)GetValue(SelectedPersonProperty); }

        set{ SetValue(SelectedPersonProperty, value); }

    }



    publicstatic readonly DependencyProperty SelectedPersonProperty =

        DependencyProperty.Register("SelectedPerson",typeof(Person),

        typeof(ViewModelWindow2),new UIPropertyMetadata(null));

**Dependency Properties** are considered a "**richer**" method of binding, as the Register method also has several overloads for<br>**PropertyChanged** and **Coerce** delegate methods.


The main drawback to **Dependency Properties** for general MVVM use is<br>**they need to be handled on the UI layer**.



For more on the **INPC vs DP debate**, read the following:


- [http://kentb.blogspot.co.uk/2009/03/view-models-pocos-versus.html](http://kentb.blogspot.co.uk/2009/03/view-models-pocos-versus.html)






## **Controlling an Application through CanExecute**


This example also shows how a command can also control whether a button is enabled or not, through it's CanExecute delegate.<br>  
<br>This again moves away from controller and more into behavior.   
<br>The action cannot even be triggered if conditions are not met, and this is clear to the user as the button is disabled.



We are not using the command parameter in this example, but relying on a ViewModel property to be populated with the selected item.<br>  
<br>If there is none, the **CanExecute** method returns **false**, which<br>**disables the button**.   
  
<br>All encapsulated in the command, nice clean code.  
<br>


public ViewModelWindow2()

{

    People = FakeDatabaseLayer.GetPeopleFromDatabase();

    NextExampleCommand = new RelayCommand(NextExample, NextExample_CanExecute);

}



bool NextExample_CanExecute(object parameter)

{

    return SelectedPerson != null;

}





## **Closing with Attached Property via Dependency Property**


To close the window in this example, we still use the **Attached Property** in the Window XAML, but the property is a<br>**Dependency Property** in the ViewModel.  
<br>


publicbool? CloseWindowFlag

{

    get{return(bool?)GetValue(CloseWindowFlagProperty); }

    set{ SetValue(CloseWindowFlagProperty, value); }

}



// Using a DependencyProperty as the backing store for CloseWindowFlag.  This enables animation, styling, binding, etc...

publicstatic readonly DependencyProperty CloseWindowFlagProperty =

    DependencyProperty.Register("CloseWindowFlag",typeof(bool?),typeof(ViewModelWindow2),new UIPropertyMetadata(null));


<br>Used simply as follows:  
<br>


voidNextExample(objectparameter)

{

    var win =new Window3(SelectedPerson);

    win.Show();

    CloseWindowFlag =true;

}






↑ [Return to Top](http://social.technet.microsoft.com/wiki/contents/articles/13536.easy-mvvm-examples-in-extreme-detail.aspx#Top)


* * *





# <a name="Using_POCO_objects_with_MVVM"></a>Using POCO Objects with MVVM


[![ ](http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/437x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8664.mvvm4.png)](http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8664.mvvm4.png)  
  
<br>A POCO class in WPF/MVVM terms is one that does not provide any PropertyChanged events.<br>


classPocoPerson

{

    publicstring FirstName {get;set; }

    publicstring LastName {get;set; }

    publicint Age {get;set; }

}


This would usually be legacy code modules, or converting from WinForms.  
<br>This next example demonstrates how things start to break, when you don't use PropertyChanged events.  
  
<br>At first, everything seems fine. Selected item is updated in all, you can change properties of existing people, and add new people through the DataGrid.  
  
<br>Those actions are all UI based actions, which change **Dependency Properties** like<br>**TextBox.Text**, and automatically fire the **PropertyChanged** event.  
  
**However**, the **TextBox** should actually be showing a<br>**time stamp**, as set by the code behind **Dispatcher Timer**.


publicViewModelWindow3(Person person)

{

    . . . snip . . .



    timer =new DispatcherTimer();

    timer.Interval = TimeSpan.FromSeconds(1);

    timer.Tick +=new EventHandler(timer_Tick);

    timer.Start();

}



voidtimer_Tick(objectsender, EventArgs e)

{

    TextProperty1 = DateTime.Now.ToString();

}


**Furthermore**, clicking the **Button** to add a new person**does not seem to work**, but it did.  
  
<br>If you then try to add a user in the DataGrid, the binding updates, and shows the previously added user.<br>**All a bit broken.**


##    
**Custom Event Self-close Hack**


Just as an alternative, this ViewModel has a custom event, to signify closure, which is handled in code behind when the ViewModel is attached.


publicWindow3(Person person)

{

    InitializeComponent();

    var vm =new ViewModelWindow3(person);

    DataContext = vm;

    vm.CloseWindowEvent +=new System.EventHandler(vm_CloseWindowEvent);

}



voidvm_CloseWindowEvent(objectsender, System.EventArgs e)

{

    this.Close();

}
  
  

## **Fixing One Property to Show the Difference**


<br>The following window is **almost identical** to the **previous POCO example**. However<br>**TextProperty1 now triggers a PropertyChanged event** in it's setter.<br>  
<br>


set

{

    if(_TextProperty1 != value)

    {

        _TextProperty1 = value;

        RaisePropertyChanged("TextProperty1");//The fix

    }

}


<br>Now you will find **the time stamp property shows** through onto the TextBox as shown below.  
  
[![ ](http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/437x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4721.mvvm5.png)](http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4721.mvvm5.png)  
  
<br>However, with events coming from the INPC interface, the **other UI bindings are now even more broken**.<br>(Try the sample project)


## **A Cleaner 'Interface' Way to Close the Window**


The behaviour of closing a window, could happily be kept with the window, if you believe that is where it belongs.<br>  
  
<br>One way of always assuring any ViewModel has the expected event shown above would be to make our ViewModels (ideally in the ViewModelBase) inherit an<br>**interface** that defines the event.  
  
<br>We can then safely **cast any ViewModel back to this interface**, and attach a handler to the expected event.


publicWindow4()

{

    InitializeComponent();

    DataContextChanged +=new DependencyPropertyChangedEventHandler(Window4_DataContextChanged);

}



voidWindow4_DataContextChanged(objectsender, DependencyPropertyChangedEventArgs e)

{

    var dc = DataContextas IClosableViewModel;

    dc.CloseWindowEvent +=new EventHandler(dc_CloseWindowEvent);

}
  


↑ [Return to Top](http://social.technet.microsoft.com/wiki/contents/articles/13536.easy-mvvm-examples-in-extreme-detail.aspx#Top)


* * *
  

# <a name="How_to_consume_a_closed_Business_Object_database_layer_web_service"></a>How to Consume a Closed Business Object (database layer, web service)


The most important message to learn from all of this is that**if you can convert the base (model) classes that you use to INPC properties, DO SO NOW**. You will save yourself a world of pain, unnecessary data marshalling through wrappers, and<br> a whole load of code that can introduce bugs and dependencies to your implementation.  
  
<br>    
<br>But what if you have a **Business Object** that handles all the work, like an<br>**existing database module**, or **web service client**?


This may therefore be a "**closed object**" that you cannot enrich with INPC on it's properties.

<br>In this case you have to fall back on **wrappers and polling**.  
  
<br>This final example ViewModel **acts as a shepherd** between our front end controls and a "**personnel management**" business object. It only exposes the following methods:  

- **GetEmployees()**
- **AddPerson(Person)**
- **DeletePerson(Person)**
- **UpdatePerson(Person)**

<br>It also has a public POCO string property **ReportTitle**.  
  
<br>Finally, there a "**Status**" enum (**Offline, Online**) which **periodically toggles** from a [**background thread] Timer**.

## **Wrapping POCOs**

<br>Firstly, we need to **marshal the data in and out** of the business object. We need to wrap the data in<br>**marshalling properties**.  
  
<br>As we only have a **GET method**for employee list, we only need a public property with a get method, to populate our DataGrid:  
  

ObservableCollection<PocoPerson> _People;

publicObservableCollection<PocoPerson> People

{

    get

    {

        _People =new ObservableCollection<PocoPerson>(personnel.GetEmployees());

        return_People;

    }

}
  
<br>The public string property "**Report Title**" is a **two-way pass-through wrapper<br>**(getter and setter). It marshals the values in and out.  
<br>   
<br>This takes us back to our first POCO example, where this is sufficient for some operations, but changes to the "back-end" data,<br>**will not automatically be reflected in the UI**.   
  
<br>There is a **Label**also bound to this property, but again it only works<br>**because the change was UI initiated**, as explained in earlier examples.  
  

publicstring ReportTitle

{

    get

    {

        returnpersonel.ReportTitle;

    }

    set

    {

        if(personel.ReportTitle != value)

        {

            personnel.ReportTitle = value;

            RaisePropertyChanged("ReportTitle");

        }

    }

}

## **Polling POCOs**

<br>The final property (BoStatus) represents the business object "**Status**" property (personel.Status), but this value is constantly updated by another thread, so we would normally miss the updates in the user interface.<br>  
  
<br>The only answer is to**poll the property for changes**.   
  
<br>BoStatus is therefore **not a wrapper**, but a **store of the "last known" value**.  
  

MvvmExample.Model.PersonelBusinessObject.StatusType _BoStatus;

publicMvvmExample.Model.PersonelBusinessObject.StatusType BoStatus

{

    get

    {

        return_BoStatus;

    }

    set

    {

        if(_BoStatus != value)

        {

            _BoStatus = value;

            RaisePropertyChanged("BoStatus");

        }

    }

}
  
<br>We use a **Timer**to frequently **check the property for changes**. This may seem expensive, but it's really not, in computer processor terms.  
  
<br>When we detect a change, we **update the Public property BoStatus**, which saves the new value locally, and<br>**fires the PropertyChanged event**.   
  
<br>Anything consuming this property will **update their bindings**, and call the getter to pick up the new value.  
  

voidCheckStatus(objectsender, EventArgs e)

{

    if(_BoStatus != personel.Status)

        BoStatus = personel.Status;

}
  
<br>Using the **CRUD** methods of our business object is really down to **<br>your own** personal design and implementation.   
  
<br>However, as a final example, I included a **very simple method for doing this**, with<br>**practically no code**!  
  
<br>

## **Virtually Codeless Master/Detail CRUD Control**


<br>This example shows a complete and virtually codeless master/detail, CRUD control (for databases, web services, etc)  
<br>    
[![ ](http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/537x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3005.mvvm6.png)](http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3005.mvvm6.png)  
  
<br>By **master/detail**, we mean there is a master list of objects. You then select a list item to get the item details in a separate box.  
  
<br>By **CRUD**, we mean **Cr**eate, **U**pdate and<br>**D**elete functionality. The three things you do to objects in a collection, or a database.  
  
<br>Normally, in a big application, we would design a stand-alone user control for an edit form, but here is a quick trick to produce the whole, fully wired edit form, using the<br>**ItemsTemplate** for an **ItemsControl**.  
  
<br>The actual edit grid is a DataTemplate, instead of an actual control. This **<br>DataTemplate** is used as the **ItemTemplate** for the **<br>ItemsControl**:


<ItemsControlBindingGroup="{Binding UpdateBindingGroup, Mode=OneWay}"ItemTemplate="{StaticResource UserGrid}"ItemsSource="{Binding SelectedPerson, Converter={StaticResource SelectedItemToItemsSource}}"/>
  
<br>The **ItemsSource** is tied to the **SelectedPerson** property of our<br>**ViewModel**.   
  
<br>If you were just editing, and not adding new users, you could bind this directly to the<br>**SelectedItem** property of the **DataGrid**, but you will see later why we don't.  
  
<br>A **BindingGroup** is defined on the **ItemsControl**, which we use later to<br>**cancel or commit changes from the form**.  
  
<br>ItemsSource expects a collection, rather than SelectedItem (SelectedPerson). So to make this trick work, we use a simple converter to wrap the selected person into a collection.  
  

publicclass SelectedItemToItemsSource : IValueConverter

{

    publicobject Convert(object value, Type targetType,objectparameter, System.Globalization.CultureInfo culture)

    {

        if(value ==null)return null;

**        returnnew List<object>() { value };**

    }



    publicobject ConvertBack(object value, Type targetType,objectparameter, System.Globalization.CultureInfo culture)

    {

        thrownew NotImplementedException();

    }

}
  
***This method means that if there is no selected item, there is no edit form.***   
***This removes the need for visibility converters, or triggers to show & hide the form!***  
  

### **How to Bind and When to Update**






Binding to properties of the **selected person**, is only the immediate<br>**DataContext** of the generated item - **direct and easy**.


<TextBoxText="{Binding FirstName, BindingGroupName=Group1, UpdateSourceTrigger=Explicit}"Grid.Column="1"/>
  
**However**, to get back to the **ViewModel** and update our<br>**"Personnel" Business Object**, we need to traverse further up the **<br>VisualTree**, for which we use **RelativeSource**:  
  

<ButtonForeground="Red"Content="Cancel"Command="{Binding DataContext.CancelCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"Margin="4,0"/>
  
<br>This binding traverses back, looking for the first instance of the **ItemsControl**. We then refer to the properties via it's<br>**DataContext**.  
  
<br>To allow us to **cancel an edit**, the binding's **UpdateSourceTrigger** is changed to<br>**Explicit**.  
  
<br>This **prevents** any updates of the **source data**, until we manually call an<br>**Update** on the bindings.  
  
<br>As these are **auto-generated** controls and bindings, we would normally have had to use<br>**VisualTreeHelper** to hunt for the controls in the VisualTree, so that we can locate and call the Update method on the bindings... Yuk...  o\_O   
  
**Instead we are using the Binding Group**we earlier attached to the<br>**ItemsControl**.   
  
<br>Each binding in the **DataTemplate** also includes a reference to this<br>**group name**:  
  

<TextBoxText="{Binding . . . BindingGroupName=Group1, . . ." />
  
**The trick to use this in an MVVM scenario** is that this **BindingGroup** needs to be defined in the<br>**ViewModel**, and passed INTO the ItemsControl, **through binding**.  
  
<br>It needs to be **already waiting**, if it is to be used by the **<br>DataTemplate bindings**.  
  

<ItemsControlBindingGroup="{Binding UpdateBindingGroup, Mode=OneWay}". . .  />
  
<br>This is then just another property of our ViewModel, **that we can use in the ViewModel** and is updated from the UI, as bindings are created and destroyed by the ItemsControl.  
  

BindingGroup _UpdateBindingGroup;

publicBindingGroup UpdateBindingGroup

{

    get

    {

        return_UpdateBindingGroup;

    }

    set

    {

        if(_UpdateBindingGroup != value)

        {

            _UpdateBindingGroup = value;

            RaisePropertyChanged("UpdateBindingGroup");

        }

    }

}



publicViewModelWindow5()

{

    . . .



    UpdateBindingGroup =new BindingGroup { Name ="Group1" };
  
<br>In our command handling methods, we can **update or cancel the changes from our ViewModel**.  
  

voidDoCancel(objectparam)

{

    UpdateBindingGroup.CancelEdit();
  

voidDoSave(objectparam)

{

    UpdateBindingGroup.CommitEdit();

###  

### **Create, Update, Delete Logic**
  
<br>To add a new user, we simply create a new "placeholder" object into SelectedPerson.  
<br>This shows and populates the form with the new user object, which we can fill in.  
<br>This is why we bind the ItemsControl ItemsSource to SelectedPerson instead of directly to DataGrid.SelectedItem.  
  
<br>If **new user deleted/cancelled**, we simply set **SeletedPerson** back to<br>**null**, which disposes of the object.  
  
<br>If **existing user cancelled**, we call **CancelEdit** on the<br>**BindingGroup**.  
  
<br>If **new user saved**, we call **AddUser** on the **<br>Business Object**, then trigger **PropertyChanged** on the **<br>People** collection, for a fresh list from the **Business Object**.  
  
<br>If **existing user saved**, we call **UpdateUser** on the<br>**Business Object** and **ComitEdit** on the **BindingGroup**  
  
<br>If **existing user deleted**, we call **DeleteUser** on the<br>**Business Object**, then trigger **PropertyChanged** on the<br>**People** collection, for a fresh list from the **Business Object**.  
  
  
<br>For example, here is what we do for the **Save** command:  
  

voidDoSave(objectparam)

{

    UpdateBindingGroup.CommitEdit();

    var person = SelectedPersonas PocoPerson;

    if(SelectedIndex == -1)

    {

        personel.AddPerson(person);

        RaisePropertyChanged("People");// Update the list from the data source

    }

    else

        personel.UpdatePerson(person);



    SelectedPerson =null;

}
  
<br>CommitEdit updates the properties in the existing collection, if you are updating an existing Person.<br>  
<br>It does not updating the list. CommitEdit will update the existing data and hence the user interface, so we don't need to request an update of the whole list.  
  
<br>I hope this article has helped to explain the Role of PropertyChanged events in MVVM, and how to wire up your controls and navigation.  
  
**Please give a couple of seconds, to rate/star the Gallery sample.**  
  
  
**DOWNLOAD :**[**http://gallery.technet.microsoft.com/Easy-MVVM-Examples-48c94de3**](http://gallery.technet.microsoft.com/Easy-MVVM-Examples-48c94de3)  
  
  
**Many more sample projects**[**available HERE**](http://code.msdn.microsoft.com/site/search?f%5B0%5D.Type=User&f%5B0%5D.Value=XAML%20guy)!!!  
   
<br>    
**If you are learning MVVM, don't forget to grab<br>**[**this essential set of classes**](http://social.technet.microsoft.com/wiki/contents/articles/13603.very-easy-mvvm.aspx)  
   


↑ [Return to Top](http://social.technet.microsoft.com/wiki/contents/articles/13536.easy-mvvm-examples-in-extreme-detail.aspx#Top)


* * *
![ ](http://c.statcounter.com/8287551/0/e9ab63ef/1/)


<!-- default layout -->

<!-- AUTO ADDED BELOW -->

<footer>
    <!-- This footer.html -->
    <script>
        var currentMousePos = { x: -1, y: -1 };

        $(document).ready(function () {
            $(document).mousemove(function (event) {
                currentMousePos.x = event.pageX;
                currentMousePos.y = event.pageY;
            });

            var args = document.location.href.match(/[^\/]+$/);
            var fileName = '';
            if (!args || args.length == 0) {
                return;
            }

            fileName = args[0];
            var infoFile = fileName.replace(".html", ".json");

            var fileInfo = "https://raw.githubusercontent.com/technet2/Wiki/master/docs/info/" + infoFile;
            var editVersion = "https://github.com/technet2/Wiki/blob/master/docs/articles/" + fileName;
            var historyVersion = "https://github.com/technet2/Wiki/commits/master/docs/articles/" + fileName;

            var $h1 = document.querySelector('h1');
            if ($h1) {
                title = $h1.innerText;
                $('#editMeCrumb').append($('<a href="' + editVersion + '">' + title + '!!!</a>'));
            }

            var url = "https://github.com/technet2/Wiki/commits/master/docs/articles/" + fileName;
            var $tab = document.querySelector('#myHistory');
            $tab.setAttribute('href', url);
            //$('#myHistory').setAttribute('href', url);

            $.getJSON(fileInfo, function (data) {
                var keyPhrases = [];
                $.each(data.KeyPhrases, function (key, val) {
                    keyPhrases.push("<span class=\"phr\" onclick=\"clickedPhrase('" + val.SafeName + "\')\">" + val.Name + "</span>&nbsp;|&nbsp;");
                });

                var netities = [];

                $.each(data.Netities, function (key, val) {
                    var name = val.Name;
                    var type = "";
                    if (val.Type) {
                        type += "" + val.Type;
                    }
                    if (val.SubType) {
                        type += ", " + val.SubType;
                    }
                    if (type != "") {
                        name += " (" + type + ")";
                    }
                    if (val.WikipediaUrl) {
                        netities.push("<a href='" + val.WikipediaUrl + "'>" + name + "</a>&nbsp;|&nbsp;");
                    }
                    else {
                        netities.push(name + "&nbsp;|&nbsp;");
                    }
                });

                if (keyPhrases.length > 0) {
                    $("<h2>Key Phrases Identified</h2>").appendTo("#tags");

                    $("<ul/>", {
                        "class": "tag-list",
                        html: keyPhrases.join("")
                    }).appendTo("#tags");
                }

                if (netities.length > 0) {
                    $("<h2>Entities on Wikipedia</h2>").appendTo("#tags");

                    $("<ul/>", {
                        "class": "tag-list",
                        html: netities.join("")
                    }).appendTo("#tags");
                }
            }).error(function () { console.log('No info file found for this page'); });

        });

        function goToIndex(file) {
            file = 'https://github.com/technet2/Wiki/blob/master/docs/index/' + file;
            console.log(file);
            window.location.href = file;
        }

        function goToSubIndex(file) {
            console.log(file);
            window.location.href = file;
        }

        function clickedPhrase(safeName) {
            //console.log(ele.innerText);
            var popup = $('#tagPopup');
            var tagList = $('#tagList');
            tagList.empty();

            var fileInfo = "https://raw.githubusercontent.com/technet2/Wiki/master/docs/index/" + safeName + ".json";

            $.getJSON(fileInfo, function (data) {
                var nextLinks = [];

                popup.css('visibility', 'visible');
                popup.css('left', currentMousePos.x);
                popup.css('top', currentMousePos.y);

                $.each(data.Refs, function (key, val) {
                    nextLinks.push("<div style='margin-bottom:8px;'><a href='/Wiki/articles/" + val.FileName + "'>" + val.Title + "</a></div>");
                });

                $("<div/>", {
                    "class": "link-list",
                    html: nextLinks.join("")
                }).appendTo("#tagList");
            });

        }

        $(function () {

            $("#rateYo").rateYo({

                onSet: function (rating, rateYoInstance) {

                    alert("Rating is set to: " + rating);
                }
            });
        });
    </script>

    <script src="/js/site.js"></script>

    <div id="tags"></div>

    <div class="footer-fragments" role="contentinfo">
        <div class="footer-fragment copyright-info" id="footer-fragment-668884183">

            <ul class="footer-fragment-links">
                <li class="message copyright">C 2015 Microsoft Corporation. All rights reserved.</li>
                <li class="message termsOfService"><a href="http://technet.microsoft.com/cc300389">Terms of Use</a> </li>
                <li class="message trademarks"><a href="http://www.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx">Trademarks</a> </li>
                <li class="message privacy"><a href="http://go.microsoft.com/fwlink/?LinkId=248681">Privacy Statement</a> </li>
                <li class="message version">[Copied from] v5.6.915.0</li>
                <img tabindex="0" style="float: right;" aria-label="Microsoft" src="https://social.technet.microsoft.com/wiki/themes/TechNetMetro/images/technet/microsoft.gif">
            </ul>

            <ul class="footer-fragment-links" style="margin-top:5px !important;">
                <li>This page has been extacted by Pete Laker, <a href="https://mvp.microsoft.com/en-us/PublicProfile/5001916">Microsoft Azure MVP</a> &amp; <a href="https://www.microsoft.com/en-gb/atwork/it-implementer/">Microsoft IT Implementer</a></li>
            </ul>
        </div>

        <style>
            .phr {
                color: cornflowerblue;
            }

                .phr:hover {
                    font-weight: bold;
                    color: blue;
                    cursor: pointer;
                }
        </style>

        <div class="footer-fragment app-insights-footer-fragment" id="footer-fragment-668884184">

            <!--<span class='phr' onclick='clickedPhrase(this)'>API</span>&nbsp;|&nbsp;-->

        </div>

        <div id="tagPopup" style="background-color:#f5f3f3; visibility:hidden; position:absolute; margin:20px; border:1px solid #000000; display:block; padding:2px;">
            <span style="position:absolute; right:0; top:0; margin:2px; width:10px; height:10px; font-size:x-small; background-color:red; color:white; font-weight:bold; border:1px solid #808080; display:block; padding:2px; cursor:pointer" onclick="$('#tagPopup').css('visibility', 'hidden')">X</span>
            <div id="tagList" style="margin:5px; margin-right:15px; font-size:x-small"></div>
        </div>


    </div>
</footer>

<!-- This footer.html -->
</body>

</html>